/*!
 * annoml v1.0.13 
 * (c) 2019 Thomas Haefeker <thomas@haefeker.net>
 * Released under the MIT License.
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("axios"),require("bootstrap-vue"),require("@fortawesome/fontawesome-svg-core"),require("@fortawesome/free-solid-svg-icons"),require("@fortawesome/vue-fontawesome"),require("vue"),require("vuex"),require("d3-svg-annotation"),require("jsum"),require("vega-embed"),require("d3"),require("lodash"),require("tiptap"),require("tiptap-extensions"),require("vue-swatches")):"function"==typeof define&&define.amd?define(["axios","bootstrap-vue","@fortawesome/fontawesome-svg-core","@fortawesome/free-solid-svg-icons","@fortawesome/vue-fontawesome","vue","vuex","d3-svg-annotation","jsum","vega-embed","d3","lodash","tiptap","tiptap-extensions","vue-swatches"],n):(t=t||self,t.Annoml=n(t.axios,t.BootstrapVue,t.fontawesomeSvgCore,t.freeSolidSvgIcons,t.vueFontawesome,t.Vue,t.Vuex,t.d3annotation,t.JSum,t.VegaEmbed,t.d3,t.lodash,t.tiptap,t.tiptapExtensions,t.Swatches))}(this,function(t,n,o,e,i,a,s,r,c,l,d,u,m,h,f){"use strict";function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t){return v(t)||b(t)||_()}function v(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function b(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function w(t,n,o,e,i,a,s,r,c,l){"boolean"!=typeof s&&(c=r,r=s,s=!1);var d="function"==typeof o?o.options:o;t&&t.render&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0,i&&(d.functional=!0)),e&&(d._scopeId=e);var u;if(a?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(a)},d._ssrRegister=u):n&&(u=s?function(){n.call(this,l(this.$root.$options.shadowRoot))}:function(t){n.call(this,r(t))}),u)if(d.functional){var m=d.render;d.render=function(t,n){return u.call(n),m(t,n)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,u):[u]}return o}function A(t){return function(t,n){return y(t,n)}}function y(t,n){var o=G?n.media||"default":t,e=J[o]||(J[o]={ids:new Set,styles:[]});if(!e.ids.has(t)){e.ids.add(t);var i=n.source;if(n.map&&(i+="\n/*# sourceURL="+n.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),e.element||(e.element=document.createElement("style"),e.element.type="text/css",n.media&&e.element.setAttribute("media",n.media),X.appendChild(e.element)),"styleSheet"in e.element)e.styles.push(i),e.element.styleSheet.cssText=e.styles.filter(Boolean).join("\n");else{var a=e.ids.size-1,s=document.createTextNode(i),r=e.element.childNodes;r[a]&&e.element.removeChild(r[a]),r.length?e.element.insertBefore(s,r[a]):e.element.appendChild(s)}}}function C(t,n){return n?n.toUpperCase():""}function $(t){for(var n,o={},e=0,i=t.split(At.styleList);e<i.length;e++){var a=i[e].split(At.styleProp),s=a[0],r=a[1];(s=s.trim())&&("string"==typeof r&&(r=r.trim()),o[(n=s,n.replace(At.kebab,C))]=r)}return o}function k(){for(var t,n,o={},e=arguments.length;e--;)for(var i=0,a=Object.keys(arguments[e]);i<a.length;i++)switch(t=a[i]){case"class":case"style":case"directives":if(Array.isArray(o[t])||(o[t]=[]),"style"===t){var s=void 0;s=Array.isArray(arguments[e].style)?arguments[e].style:[arguments[e].style];for(var r=0;r<s.length;r++){var c=s[r];"string"==typeof c&&(s[r]=$(c))}arguments[e].style=s}o[t]=o[t].concat(arguments[e][t]);break;case"staticClass":if(!arguments[e][t])break;void 0===o[t]&&(o[t]=""),o[t]&&(o[t]+=" "),o[t]+=arguments[e][t].trim();break;case"on":case"nativeOn":o[t]||(o[t]={});for(var l=0,d=Object.keys(arguments[e][t]||{});l<d.length;l++)n=d[l],o[t][n]?o[t][n]=[].concat(o[t][n],arguments[e][t][n]):o[t][n]=arguments[e][t][n];break;case"attrs":case"props":case"domProps":case"scopedSlots":case"staticStyle":case"hook":case"transition":o[t]||(o[t]={}),o[t]=wt({},arguments[e][t],o[t]);break;case"slot":case"key":case"ref":case"tag":case"show":case"keepAlive":default:o[t]||(o[t]=arguments[e][t])}return o}function x(t){return(x="function"==typeof Symbol&&"symbol"===p(Symbol.iterator)?function(t){return p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":p(t)})(t)}function E(t){return(E="function"==typeof Symbol&&"symbol"===p(Symbol.iterator)?function(t){return p(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":p(t)})(t)}function P(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,e)}return o}function z(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?P(o,!0).forEach(function(n){S(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):P(o).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function S(t,n,o){return n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function T(t){return D(t)||R(t)||q()}function q(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function R(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function D(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}function O(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,e)}return o}function I(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?O(o,!0).forEach(function(n){V(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):O(o).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function V(t,n,o){return n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a,s=s&&s.hasOwnProperty("default")?s.default:s;var L="default"in r?r.default:r;c=c&&c.hasOwnProperty("default")?c.default:c,l=l&&l.hasOwnProperty("default")?l.default:l,u=u&&u.hasOwnProperty("default")?u.default:u,f=f&&f.hasOwnProperty("default")?f.default:f,a.use(s);var B=new s.Store({state:{settings:{debug:!0},discussion:{published:!1},visualization:{showPointAnnotations:!0,showFreePointAnnotations:!0,showRectangleAnnotations:!0,showFreeRectangleAnnotations:!0,selectable:!0,fitChart:!0},annotation:{pointAnnotations:[],rectangleAnnotations:[],currentPost:null,currentPointAnnotations:[],currentRectangleAnnotations:[],usedColors:[]}},getters:{debug:function(t){return t.settings.debug},getSettings:function(t){return t.settings},showPointAnnotations:function(t){return t.visualization.showPointAnnotations},showFreePointAnnotations:function(t){return t.visualization.showFreePointAnnotations},showRectangleAnnotations:function(t){return t.visualization.showRectangleAnnotations},showFreeRectangleAnnotations:function(t){return t.visualization.showFreeRectangleAnnotations},visualizationSelectable:function(t){return t.visualization.selectable},visualizationFit:function(t){return t.visualization.fitChart},getUsedColors:function(t){return t.annotation.usedColors},getCurrentPost:function(t){return t.annotation.currentPost},hasCurrentPost:function(t){return null!==t.annotation.currentPost},pointAnnotations:function(t){return t.annotation.pointAnnotations},rectangleAnnotations:function(t){return t.annotation.rectangleAnnotations},currentPointAnnotations:function(t){return t.annotation.currentPointAnnotations},currentRectangleAnnotations:function(t){return t.annotation.currentRectangleAnnotations}},mutations:{clearStore:function(t){t.annotation.pointAnnotations=[],t.annotation.rectangleAnnotations=[],t.annotation.currentPointAnnotations=[],t.annotation.currentRectangleAnnotations=[],t.annotation.currentPost=null,t.annotation.stateColor=[],t.visualization.showPointAnnotations=!0,t.visualization.showFreePointAnnotations=!0,t.visualization.showRectangleAnnotations=!0,t.visualization.showFreeRectangleAnnotations=!0,t.visualization.selectable=!0,t.visualization.fitChart=!0},importSettings:function(t,n){t.settings=n},toggleShowPointAnnotations:function(t){t.visualization.showPointAnnotations=!t.visualization.showPointAnnotations},toggleShowFreePointAnnotations:function(t){t.visualization.showFreePointAnnotations=!t.visualization.showFreeRectangleAnnotations},toggleShowRectangleAnnotations:function(t){t.visualization.showRectangleAnnotations=!t.visualization.showRectangleAnnotations},toggleShowFreeRectangleAnnotations:function(t){t.visualization.showFreeRectangleAnnotations=!t.visualization.showFreeRectangleAnnotations},toggleVisualizationFit:function(t){t.visualization.fitChart=!t.visualization.fitChart},enableSelectable:function(t){t.visualization.selectable=!0},disableSelectable:function(t){t.visualization.selectable=!1},addUsedColor:function(t,n){t.annotation.usedColors.includes(n)||t.annotation.usedColors.push(n.toUpperCase())},removeUsedColor:function(t,n){n&&(t.annotation.usedColors=t.annotation.usedColors.filter(function(t){return t!==n.toUpperCase()}))},setCurrentPost:function(t,n){t.annotation.currentPost=n},removeCurrentPost:function(t){t.annotation.currentPost=null},addPointAnnotation:function(t,n){t.annotation.pointAnnotations.push(n)},addPointAnnotations:function(t,n){t.annotation.pointAnnotations=t.annotation.pointAnnotations.concat(n)},addRectangleAnnotation:function(t,n){t.annotation.rectangleAnnotations.push(n)},addRectangleAnnotations:function(t,n){t.annotation.rectangleAnnotations=t.annotation.rectangleAnnotations.concat(n)},addCurrentPointAnnotation:function(t,n){t.annotation.currentPointAnnotations.push(n)},removeCurrentPointAnnotation:function(t,n){t.annotation.currentPointAnnotations=t.annotation.currentPointAnnotations.filter(function(t){return t.id!==n.id})},setCurrentPointAnnotations:function(t,n){t.annotation.currentPointAnnotations=n},addCurrentRectangleAnnotation:function(t,n){t.annotation.currentRectangleAnnotations.push(n)},removeCurrentRectangleAnnotation:function(t,n){t.annotation.currentRectangleAnnotations=t.annotation.currentRectangleAnnotations.filter(function(t){return t.id!==n.id})},setCurrentRectangleAnnotations:function(t,n){t.annotation.currentRecAnnotations=n},removePointAnnotations:function(t,n){t.annotation.pointAnnotations=t.annotation.pointAnnotations.filter(function(t){return!n.find(function(n){return t.id===n.id})})},removeRectangleAnnotations:function(t,n){t.annotation.rectangleAnnotations=t.annotation.rectangleAnnotations.filter(function(t){return!n.find(function(n){return t.id===n.id})})},clearCurrentAnnotations:function(t){t.annotation.currentPointAnnotations=[],t.annotation.currentRectangleAnnotations=[]},mergeCurrentAnnotations:function(t){t.annotation.pointAnnotations=t.annotation.pointAnnotations.concat(t.annotation.currentPointAnnotations),t.annotation.rectangleAnnotations=t.annotation.rectangleAnnotations.concat(t.annotation.rectangleAnnotations)}},actions:{}}),F={POINT:"POINT",FREEPOINT:"FREEPOINT",RECTANGLE:"RECTANGLE",FREERECTANGLE:"FREERECTANGLE"},H={HIDDEN:"gray",SELECTED:"black"},N=["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],U={types:F,stateColor:H,postColors:N,getFreeColor:function(t){return N.filter(function(n){return!t.includes(n)})[0]},selectAnnotation:function(t,n,o){n.color===H.SELECTED?n.color=o:t.forEach(function(t){t.forEach(function(t){t.id===n.id?t.color=H.SELECTED:t.color=o})})},hideAnnotation:function(t,n,o){n.color===H.HIDDEN?n.color=o:t.forEach(function(t){t.forEach(function(t){t.id===n.id?t.color=H.HIDDEN:t.color=o})})},hideAnnotations:function(t,n,o){n?t.forEach(function(t){t.forEach(function(t){t.color=H.HIDDEN})}):t.forEach(function(t){t.forEach(function(t){t.color=o})})},concatAndSortAnnotations:function(t,n){var o;return(o=[]).concat.apply(o,g(t)).sort(n)},concatAndFilterAnnotations:function(t,n){var o;return(o=[]).concat.apply(o,g(t)).filter(n)},concatAnnotations:function(t){var n;return(n=[]).concat.apply(n,g(t))}},j={annotation:U},Q=function(t){return{getRecentDiscussions:function(n){var o="/api/discussions/recent?results=".concat(n);return t.get(o).then(function(t){return t.data})},getDiscussionsForVisualization:function(n){var o="/api/discussions/visualizations/".concat(n);return t.get(o).then(function(t){return t.data})},createDiscussionWithUrl:function(n){var o={url:n};return t.post("/api/create/url",o).then(function(t){return t.data})},createDiscussionWithId:function(n){var o={reference:n};return t.post("/api/create/reference",o).then(function(t){return t.data})},createDiscussionWithSchema:function(n){var o=n;return t.post("/api/create/reference",o).then(function(t){return t.data})},getDiscussion:function(n){var o="/discussions/".concat(n);return t.get(o).then(function(t){return t.data})},updateDiscussion:function(n,o,e){var i="discussions/".concat(n),a={hash:o,title:e};return t.put(i,a).then(function(t){return t.data})},deleteDiscussion:function(n){var o="discussions/".concat(n);return t.delete(o).then(function(t){return t.data})},addQuestion:function(n,o){var e="/discussions/".concat(n,"/question");return t.post(e,o).then(function(t){return t.data})},updateQuestion:function(n){var o="/discussions/questions/".concat(n.id);return t.put(o,n).then(function(t){return t.data})},deleteQuestion:function(n,o){var e="/discussions/questions/".concat(o.id);return t.delete(e).then(function(t){return t.data})},upVoteQuestion:function(n){var o="/discussions/questions/".concat(n.id,"/vote/up");return t.get(o).then(function(t){return t.data})},downVoteQuestion:function(n){var o="/discussions/questions/".concat(n.id,"/vote/down");return t.get(o).then(function(t){return t.data})},addAnswer:function(n,o){var e="/discussions/questions/".concat(n,"/answer");return t.post(e,o).then(function(t){return t.data})},updateAnswer:function(n){var o="/discussions/answers/".concat(n.id);return t.put(o,n).then(function(t){return t.data})},deleteAnswer:function(n){var o="/discussions/answers/".concat(n.id);return t.delete(o).then(function(t){return t.data})},upVoteAnswer:function(n){var o="/discussions/answers/".concat(n.id,"/vote/up");return t.get(o).then(function(t){return t.data})},downVoteAnswer:function(n){var o="/discussions/answers/".concat(n.id,"/vote/down");return t.get(o).then(function(t){return t.data})},addComment:function(n,o){var e="/discussions/answers/".concat(n,"/comment");return t.post(e,o).then(function(t){return t.data})},updateComment:function(n){var o="/discussions/comments/".concat(n.id);return t.put(o,n).then(function(t){return t.data})},deleteComment:function(n){var o="/discussions/comments/".concat(n.id);return t.delete(o).then(function(t){return t.data})},upVoteComment:function(n){var o="/discussions/comments/".concat(n.id,"/vote/up");return t.get(o).then(function(t){return t.data})},downVoteComment:function(n){var o="/discussions/comments/".concat(n.id,"/vote/down");return t.get(o).then(function(t){return t.data})},getVisualization:function(n){var o="/visualizations/".concat(n);return t.get(o).then(function(t){return t.data})},getResourceVisualization:function(n,o){var e="".concat(n,"/").concat(o);return t.get(e).then(function(t){return t.data})},getUser:function(n,o){var e="".concat(n,"/").concat(o);return t.get(e).then(function(t){return t.data})}}},M={name:"VegaAnnotationToolbar",props:{tools:Object,currentTool:Object},data:function(){return{}},created:function(){this.setTool(this.tools.pointAnnotation)},methods:{selectNoTool:function(){this.setTool(this.tools.noTool)},selectPointAnnotation:function(){this.setTool(this.tools.pointAnnotation)},selectFreePointAnnotation:function(){this.setTool(this.tools.freePointAnnotation)},selectRectangleAnnotation:function(){this.setTool(this.tools.rectangleAnnotation)},selectFreeRectangleAnnotation:function(){this.setTool(this.tools.freeRectangleAnnotation)},setTool:function(t){this.$emit("tool",t)}}},W=w,G="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase()),X=document.head||document.getElementsByTagName("head")[0],J={},Y=A;const Z=M;var K=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("b-button-toolbar",{staticClass:"mb-2"},[o("b-button-group",{staticClass:"annotation-tools"},[t.tools.noTool.disabled?t._e():o("b-button",{attrs:{disabled:!t.$annomlstore.getters.visualizationSelectable,pressed:t.currentTool===t.tools.noTool},on:{click:t.selectNoTool}},[o("font-awesome-icon",{attrs:{icon:"hand-paper"}})],1),t._v(" "),t.tools.pointAnnotation.disabled?t._e():o("b-button",{attrs:{disabled:!t.$annomlstore.getters.visualizationSelectable||!t.$annomlstore.getters.showPointAnnotations,pressed:t.currentTool===t.tools.pointAnnotation},on:{click:t.selectPointAnnotation}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1),t._v("\n        Point")],1),t._v(" "),t.tools.freePointAnnotation.disabled?t._e():o("b-button",{attrs:{disabled:!t.$annomlstore.getters.visualizationSelectable||!t.$annomlstore.getters.showFreePointAnnotations,pressed:t.currentTool===t.tools.freePointAnnotation},on:{click:t.selectFreePointAnnotation}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"circle",transform:"shrink-9 down-7 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-5 right-6"}})],1),t._v("\n        Free Point")],1),t._v(" "),t.tools.rectangleAnnotation.disabled?t._e():o("b-button",{attrs:{disabled:!t.$annomlstore.getters.visualizationSelectable||!t.$annomlstore.getters.showRectangleAnnotations,pressed:t.currentTool===t.tools.rectangleAnnotation},on:{click:t.selectRectangleAnnotation}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1),t._v("\n        Rectangle")],1),t._v(" "),t.tools.freeRectangleAnnotation.disabled?t._e():o("b-button",{attrs:{disabled:!t.$annomlstore.getters.visualizationSelectable||!t.$annomlstore.getters.showFreeRectangleAnnotations,pressed:t.currentTool===t.tools.freeRectangleAnnotation},on:{click:t.selectFreeRectangleAnnotation}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"circle",transform:"shrink-9 down-6 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-4 right-6"}})],1),t._v("\n        Free Rectangle")],1)],1),t._v(" "),o("b-dropdown",{staticClass:"mx-1 ",attrs:{right:"",text:"Annotations"}},[t.tools.pointAnnotation.disabled?t._e():o("b-dropdown-item",{attrs:{active:t.$annomlstore.getters.showPointAnnotations},on:{click:function(n){return t.$annomlstore.commit("toggleShowPointAnnotations")}}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1),t._v("\n        Point Annotations")],1),t._v(" "),t.tools.freePointAnnotation.disabled?t._e():o("b-dropdown-item",{attrs:{active:t.$annomlstore.getters.showFreePointAnnotations},on:{click:function(n){return t.$annomlstore.commit("toggleShowFreePointAnnotations")}}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{style:{color:"black"},attrs:{icon:"circle",transform:"shrink-9 down-7 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-5 right-6"}})],1),t._v("\n        Free Point Annotations")],1),t._v(" "),t.tools.rectangleAnnotation.disabled?t._e():o("b-dropdown-item",{attrs:{active:t.$annomlstore.getters.showRectangleAnnotations},on:{click:function(n){return t.$annomlstore.commit("toggleShowRectangleAnnotations")}}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1),t._v("\n        Rectangle Annotations")],1),t._v(" "),t.tools.freeRectangleAnnotation.disabled?t._e():o("b-dropdown-item",{attrs:{active:t.$annomlstore.getters.showFreeRectangleAnnotations},on:{click:function(n){return t.$annomlstore.commit("toggleShowFreeRectangleAnnotations")}}},[o("font-awesome-layers",{staticClass:"mr-1"},[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{style:{color:"black"},attrs:{icon:"circle",transform:"shrink-9 down-6 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-4 right-6"}})],1),t._v("\n        Free Rectangle Annotations")],1)],1),t._v(" "),o("b-dropdown",{staticClass:"mx-1 ",attrs:{right:"",text:"Options"}},[o("b-dropdown-item",{attrs:{active:t.$annomlstore.getters.visualizationFit},on:{click:function(n){return t.$annomlstore.commit("toggleVisualizationFit")}}},[o("font-awesome-icon",{attrs:{icon:"expand-arrows-alt"}}),t._v(" Fit\n        Chat")],1)],1)],1)],1)},tt=[];const nt=function(t){t&&t("data-v-288e7a4e_0",{source:".status-tile[data-v-288e7a4e]{display:block;border-radius:20px;padding:5px;border:2px solid gray;color:gray}.selectable[data-v-288e7a4e]{border:2px solid green;color:green}",map:void 0,media:void 0})};var ot=W({render:K,staticRenderFns:tt},nt,Z,"data-v-288e7a4e",!1,void 0,Y,void 0),et={name:"VegaChart",props:{chart:{type:Object,default:function(){return null}},annotations:{type:Object,default:function(){return{pointAnnotations:[],rectangleAnnotations:[]}}},tempAnnotations:{type:Array,default:function(){return[]}}},data:function(){return{view:null,hideAnnotations:!1,svgAnnotations:{tempAnnotations:null,pointAnnotations:null,rectangleAnnotations:null},doubleClickTime:0,doubleClickThreshold:400,options:{logLevel:"debug",renderer:"svg",actions:!1},defaultWidth:600,defaultHeight:600,size:{},annotationOptions:{annotationSize:2,editMode:!1,hideOtherAnnotations:!0}}},watch:{view:function(t,n){this.view&&(n&&this.unbindEvents(n),t&&this.bindEvents(t))},chart:{handler:function(){this.chart&&this.updateChart()}},annotations:{handler:function(){this.drawAnnotations()},deep:!0},tempAnnotations:{handler:function(){this.drawAnnotations()},deep:!0}},mounted:function(){var t=this;this.$annomlstore.watch(function(t,n){return n.showPointAnnotations},function(){return t.drawAnnotations()}),this.$annomlstore.watch(function(t,n){return n.showFreePointAnnotations},function(){return t.drawAnnotations()}),this.$annomlstore.watch(function(t,n){return n.showRectangleAnnotations},function(){return t.drawAnnotations()}),this.$annomlstore.watch(function(t,n){return n.showFreeRectangleAnnotations},function(){return t.drawAnnotations()}),this.$annomlstore.watch(function(t,n){return n.visualizationFit},function(n){n?t.createChart():(t.chart.width=t.defaultWidth,t.chart.height=t.defaultHeight,t.updateChart())}),this.createChart(),window.addEventListener("resize",function(){console.log("resize"),setTimeout(t.resize(),300)})},beforeDestroy:function(){window.removeEventListener("resize",function(){}),this.unbindEvents(this.view),this.view.finalize()},methods:{createChart:function(){var t=this;this.setDefaultSize(this.chart);var n=this.calculateVisualizationSize();this.chart.width=n.width-90,this.chart.height=n.height;var o=this;l(this.$refs.chart,this.chart,this.options).then(function(n){o.view=n.view,t.drawAnnotations();var e=document.getElementById("visualization-container");o.size.widthOffset=e.clientWidth-o.view.width(),o.size.heightOffset=e.clientHeight-o.view.height()})},updateChart:function(){var t=this;this.view.width(this.chart.width),this.view.height(this.chart.height),this.view.runAsync().then(function(){t.drawAnnotations()})},bindEvents:function(t){var n=this;t.addEventListener("click",this.clickHandler),t.addEventListener("wheel",function(){n.hideAnnotations?n.redrawAnnoations(n):(n.hideAnnotations=!0,n.removeAnnotations())}),t.addEventListener("mousedown",function(){n.removeAnnotations()}),t.addEventListener("mouseup",function(){n.drawAnnotations()})},unbindEvents:function(t){t.removeEventListener("click")},clickHandler:function(t,n){n.tooltip&&this.$emit("click",n)},redrawAnnoations:u.debounce(function(t){t.hideAnnotations=!1,t.drawAnnotations()},100),drawAnnotations:function(){var t=d.select(this.$refs.chart.getElementsByTagName("svg")[0]);this.removeAnnotations(),this.tempAnnotations.length>0&&(this.svgAnnotations.tempAnnotations=this.makeAnnotations(this.tempAnnotations,r.annotationBadge),t.append("g").attr("class","annotation-group-temp").call(this.svgAnnotations.tempAnnotations)),(!this.annotationOptions.hideOtherAnnotations||this.tempAnnotations.length<=0)&&(this.annotations.pointAnnotations.length>0&&this.$annomlstore.getters.showPointAnnotations&&(this.svgAnnotations.pointAnnotations=this.makeAnnotations(this.annotations.pointAnnotations.filter(function(t){return t.color!==j.annotation.stateColor.HIDDEN}),r.annotationCalloutCircle),t.append("g").attr("class","annotation-group-points").call(this.svgAnnotations.pointAnnotations)),this.annotations.rectangleAnnotations.length>0&&this.$annomlstore.getters.showRectangleAnnotations&&(this.svgAnnotations.rectangleAnnotations=this.makeRectangleAnnotations(this.annotations.rectangleAnnotations.filter(function(t){return t.color!==j.annotation.stateColor.HIDDEN}),r.annotationCalloutRect),t.append("g").attr("class","annotation-group-rectangles").call(this.svgAnnotations.rectangleAnnotations))),d.selectAll(".annotations").each(function(t){t.annotations.forEach(function(t){t.mark={marktype:null}})})},makeAnnotations:function(t,n){var o=this;return r.annotation().editMode(this.annotationOptions.editMode).type(n).accessors({x:function(t){return o.calculateXCoordinate(t)},y:function(t){return o.calculateYCoordinate(t)}}).annotations(t)},makeRectangleAnnotations:function(t,n){var o=this,e=[];return t.forEach(function(t){var n={annotationType:t.annotationType,id:t.id,note:t.note,color:t.color,data:t.data.p1,subject:{width:o.calculateXCoordinate(t.data.p2)-o.calculateXCoordinate(t.data.p1),height:o.calculateYCoordinate(t.data.p2)-o.calculateYCoordinate(t.data.p1)}};e.push(n)}),r.annotation().editMode(this.annotationOptions.editMode).type(n).accessors({x:function(t){return o.calculateXCoordinate(t)},y:function(t){return o.calculateYCoordinate(t)}}).annotations(e)},calculateXCoordinate:function(t){var n=this;return this.view.scale("x")(t[Object.keys(t).filter(function(t){return t.endsWith(n.chart.encoding.x.field)})])+this.view.origin()[0]+this.view.padding().left},calculateYCoordinate:function(t){var n=this;return this.view.scale("y")(t[Object.keys(t).filter(function(t){return t.endsWith(n.chart.encoding.y.field)})])+this.view.origin()[1]+this.view.padding().top},removeAnnotations:function(){d.selectAll(".annotation-group-temp").remove(),d.selectAll(".annotation-group-points").remove(),d.selectAll(".annotation-group-rectangles").remove()},setDefaultSize:function(t){t.width?this.defaultWidth=t.width:t.config&&t.config.view&&(t.config.view.width?this.defaultWidth=t.config.view.width:console.log("SIZE: using deafault width")),t.height?this.defaultHeight=t.height:t.config&&t.config.view&&(t.config.view.height?this.defaultHeight=t.config.view.height:console.log("SIZE: using deafault height"))},getContainerSize:function(){var t=document.getElementById("visualization-container"),n=t.clientWidth,o=t.innerHeight;return t.innerHeight>window.innerHeight&&(o=window.innerHeight-200),{width:n,height:o}},calculateVisualizationSize:function(){var t=this.getContainerSize().width,n=this.getContainerSize().height,o=this.defaultWidth,e=this.defaultHeight,i=1;if(this.$annomlstore.getters.visualizationFit){var a=1;t>0&&(a=t/o);var s=1;n>0&&(s=n/e),i=s>a?s:a}else o>t&&t>0&&(i=t/o),e>n&&n>0&&(i=n/e);return 1!==i&&(o=Math.floor(o*i),e=Math.floor(e*i)),{width:o,height:e,scaleFactor:i}},resize:function(){var t=this.calculateVisualizationSize();t.width.valueOf()===this.chart.width.valueOf()&&t.height.valueOf()===this.chart.height.valueOf()||(this.size.widthOffset&&this.$annomlstore.visualizationFit?this.chart.width=t.width-this.size.widthOffset:this.chart.width=t.width,this.size.heightOffset&&this.$annomlstore.visualizationFit?this.chart.height=t.height-this.size.heightOffset:this.chart.height=t.height,this.updateChart())}}};const it=et;var at=function(){var t=this,n=t.$createElement;return(t._self._c||n)("div",{ref:"chart",attrs:{id:"chart"}})},st=[];const rt=function(t){t&&t("data-v-c8f97854_0",{source:"#vis[data-v-c8f97854]{width:100%}",map:void 0,media:void 0})};var ct=W({render:at,staticRenderFns:st},rt,it,"data-v-c8f97854",!1,void 0,Y,void 0),lt={name:"Loading",props:{message:{type:String,default:function(){return"Loading"}},warning:{type:String,default:function(){return null}}}};const dt=lt;var ut=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"loading"},[t.warning?o("div",[o("font-awesome-icon",{style:{color:"black"},attrs:{size:"lg",icon:"exclamation-circle"}}),t._v(" "),o("h4",[t._v(t._s(t.warning))])],1):o("div",[t.warning?t._e():o("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{label:t.message}}),t._v(" "),o("h4",[t._v(t._s(t.message))])],1)])},mt=[];const ht=function(t){t&&t("data-v-50ca6424_0",{source:".loading[data-v-50ca6424]{display:block;width:100%;height:100%;text-align:center;padding-top:20%}",map:void 0,media:void 0})};var ft=W({render:ut,staticRenderFns:mt},ht,dt,"data-v-50ca6424",!1,void 0,Y,void 0),pt={name:"VisualizationView",components:{Loading:ft,VegaAnnotationOptions:ot,VegaChart:ct},props:{discussion:{type:Object,default:function(){return null}}},data:function(){return{visualization:null,chart:null,questions:null,annotation:null,currentTool:null,tempAnnotations:[],vegaAnnotations:{pointAnnotations:[],rectangleAnnotations:[]},tools:{noTool:{type:L.annotationBadge,disabled:!1},pointAnnotation:{name:j.annotation.types.POINT,type:L.annotationCalloutCircle,disabled:!1},freePointAnnotation:{name:j.annotation.types.FREEPOINT,type:L.annotationCalloutCircle,disabled:!0},rectangleAnnotation:{name:j.annotation.types.RECTANGLE,type:L.annotationCalloutRect,tempPoint:null,disabled:!1},freeRectangleAnnotation:{name:j.annotation.types.FREERECTANGLE,type:L.annotationCalloutRect,tempPoint:null,disabled:!0}},visualizationFailed:!1,resourceFailed:!1,modifiedWarning:!1}},
created:function(){var t=this;Q(this.$serviceApi).getVisualization(this.discussion.visualization.id).then(function(n){t.visualization=n,t.visualization.schema?t.chart=t.visualization.schema:t.visualization.reference?Q(t.$resourceApi).getResourceVisualization(t.$annomlsettings.resourceProvider.endpoints.visualization,t.visualization.reference,t.$annomlsettings.resourceProvider.accessToken).then(function(n){t.visualization=n,t.chart=JSON.parse(n.schema)}).catch(function(n){console.log(n),t.resourceFailed=!0}):console.log(t.visualization.url)}).catch(function(n){console.log(n),t.visualizationFailed=!1}),this.$annomlstore.watch(function(t,n){return n.pointAnnotations},function(n){t.vegaAnnotations.pointAnnotations=j.annotation.concatAnnotations([n,t.$annomlstore.getters.currentPointAnnotations])}),this.$annomlstore.watch(function(t,n){return n.rectangleAnnotations},function(n){t.vegaAnnotations.rectangleAnnotations=j.annotation.concatAnnotations([n,t.$annomlstore.getters.currentRectangleAnnotations])}),this.$annomlstore.watch(function(t,n){return n.currentPointAnnotations},function(n){t.vegaAnnotations.pointAnnotations=j.annotation.concatAnnotations([n,t.$annomlstore.getters.pointAnnotations])}),this.$annomlstore.watch(function(t,n){return n.currentRectangleAnnotations},function(n){t.vegaAnnotations.rectangleAnnotations=j.annotation.concatAnnotations([n,t.$annomlstore.getters.rectangleAnnotations])})},watch:{chart:function(){if(this.chart)if(this.discussion.visualizationHash){var t=c.digest(this.chart,"SHA256","hex");t!==this.discussion.visualizationHash&&(this.modifiedWarning=!0)}else this.$annomlsettings.currentUser===this.discussion.author.externalId&&(this.discussion.visualizationHash=c.digest(this.chart,"SHA256","hex"),this.modifiedWarning=!1)}},methods:{createAnnotation:function(t){t.datum&&this.$annomlstore.getters.visualizationSelectable&&(this.currentTool===this.tools.pointAnnotation?this.addPointAnnotation(t):this.currentTool===this.tools.rectangleAnnotation&&(null===this.tools.rectangleAnnotation.tempPoint?(this.tools.rectangleAnnotation.tempPoint=t,this.addTempPointAnnotation(t)):this.tools.rectangleAnnotation.tempPoint&&this.addRectangleAnnotation(t)))},clearTempPoints:function(){this.tempAnnotations=[],this.tools.rectangleAnnotation.tempPoint=null},addTempPointAnnotation:function(t){var n={};n.annotationType="TEMP",n.data=t.datum,n.subject={radius:5},n.color=j.annotation.stateColor.SELECTED,this.tempAnnotations.push(n)},addPointAnnotation:function(t){this.$annomlstore.commit("disableSelectable");var n={};n.annotationType=this.tools.pointAnnotation.name,n.id=Date.now(),n.note={title:"Point Annotation"},n.subject={radius:8},n.data=t.datum,this.$annomlstore.getters.hasCurrentPost?n.color=this.$annomlstore.getters.getCurrentPost.color:n.color=j.annotation.stateColor.SELECTED,this.$annomlstore.commit("addCurrentPointAnnotation",n)},addRectangleAnnotation:function(t){var n=this.tools.rectangleAnnotation.tempPoint,o={};o.annotationType=this.tools.rectangleAnnotation.name,o.id=Date.now(),o.note={title:"Rectangle Annotation"},o.data={p1:n.datum,p2:t.datum},o.subject={width:t.x-n.x,height:t.y-n.y},this.$annomlstore.getters.hasCurrentPost?o.color=this.$annomlstore.getters.getCurrentPost.color:o.color=j.annotation.stateColor.SELECTED,this.$annomlstore.commit("addCurrentRectangleAnnotation",o),this.clearTempPoints()},setTool:function(t){this.currentTool=t}}};const gt=pt;var vt=function(){var t=this,n=t.$createElement,o=t._self._c||n;return t.visualization?o("div",{ref:"vis",staticClass:"visualization-view mt-4"},[o("div",{staticClass:"visualization"},[o("vega-annotation-options",{attrs:{tools:t.tools,"current-tool":t.currentTool},on:{tool:t.setTool}}),t._v(" "),o("b-alert",{attrs:{show:t.visualizationFailed,variant:"danger"}},[t._v("\n      Loading visualization failed!\n    ")]),t._v(" "),o("b-alert",{attrs:{show:t.resourceFailed,variant:"warning"}},[t._v("\n      Visualization cannot been loaded!\n    ")]),t._v(" "),o("b-alert",{attrs:{show:t.modifiedWarning,dismissible:"",variant:"info"}},[t._v("\n      Visualization was modified by resource owner!\n    ")]),t._v(" "),t.chart?o("div",{attrs:{id:"visualization-container"}},[o("vega-chart",{attrs:{"visualiazion-id":t.visualization.id,chart:t.chart,annotations:t.vegaAnnotations,"temp-annotations":t.tempAnnotations},on:{click:t.createAnnotation}}),t.$annomlstore.getters.debug?o("span",{staticStyle:{color:"lightgray"}},[t._v("\n        Hash: "+t._s(t.discussion.visualizationHash))]):t._e()],1):o("loading",{attrs:{message:"Loading Visualization"}})],1),t._v(" "),t.visualization.description?o("p",[t._v(t._s(t.visualization.description))]):t._e()]):t._e()},bt=[];var _t=W({render:vt,staticRenderFns:bt},void 0,gt,"data-v-429858f2",!1,void 0,void 0,void 0),wt=function(){return(wt=Object.assign||function(t){for(var n,o=1,e=arguments.length;o<e;o++)for(var i in n=arguments[o])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},At={kebab:/-(\w)/g,styleProp:/:(.*)/,styleList:/;(?![^(]*\))/g},yt=Array.isArray,Ct=function(t,n){return-1!==t.indexOf(n)},$t=Object.assign,kt=Object.keys,xt=Object.freeze,Et=Object.create,Pt=function(t){return null!==t&&"object"===x(t)},zt=function(t){return"[object Object]"===Object.prototype.toString.call(t)},St=function(t){var n=Et(null);return function(){for(var o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];var a=JSON.stringify(e);return n[a]=n[a]||t.apply(null,e)}},Tt=function(t){return E(t)},qt=function(t){return void 0===t},Rt=function(t){return null===t},Dt=function(t){return"string"===Tt(t)},Ot=function(t){return Dt(t)||(t=String(t)),t=t.trim(),t.charAt(0).toUpperCase()+t.slice(1)},It=function(t,n){return n+(t?Ot(t):"")},Vt=function t(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return yt(n)?n.reduce(function(n,o){return[].concat(T(n),[t(o,o)])},[]):zt(n)?kt(n).reduce(function(o,e){return z({},o,S({},e,t(n[e],n[e])))},{}):o},Lt=function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!(n=yt(n)?n.join("."):n)||!Pt(t))return o;if(n in t)return t[n];n=String(n).replace(/\[(\d+)]/g,".$1");var e=n.split(".").filter(Boolean);return 0===e.length?o:e.every(function(n){return Pt(t)&&n in t&&null!=(t=t[n])})?t:o},Bt=function t(n){return kt(n).forEach(function(o){var e=n[o];n[o]=e&&(zt(e)||yt(e))?t(e):e}),xt(n)}({breakpoints:["xs","sm","md","lg","xl"],BAlert:{dismissLabel:"Close",variant:"info"},BBadge:{variant:"secondary"},BButton:{variant:"secondary"},BButtonClose:{textVariant:null,ariaLabel:"Close"},BCardSubTitle:{subTitleTextVariant:"muted"},BCarousel:{labelPrev:"Previous Slide",labelNext:"Next Slide",labelGotoSlide:"Goto Slide",labelIndicators:"Select a slide to display"},BDropdown:{toggleText:"Toggle Dropdown",variant:"secondary",splitVariant:null},BFormFile:{browseText:"Browse",placeholder:"No file chosen",dropPlaceholder:"Drop files here"},BFormText:{textVariant:"muted"},BImg:{blankColor:"transparent"},BImgLazy:{blankColor:"transparent"},BJumbotron:{bgVariant:null,borderVariant:null,textVariant:null},BListGroupItem:{variant:null},BModal:{titleTag:"h5",size:"md",headerBgVariant:null,headerBorderVariant:null,headerTextVariant:null,headerCloseVariant:null,bodyBgVariant:null,bodyTextVariant:null,footerBgVariant:null,footerBorderVariant:null,footerTextVariant:null,cancelTitle:"Cancel",cancelVariant:"secondary",okTitle:"OK",okVariant:"primary",headerCloseLabel:"Close"},BNavbar:{variant:null},BNavbarToggle:{label:"Toggle navigation"},BPopover:{boundary:"scrollParent",boundaryPadding:5,customClass:null,delay:0,variant:null},BProgress:{variant:null},BProgressBar:{variant:null},BSpinner:{variant:null},BTable:{selectedVariant:"primary",headVariant:null,footVariant:null},BToast:{toaster:"b-toaster-top-right",autoHideDelay:5e3,variant:null,toastClass:null,headerClass:null,bodyClass:null,solid:!1},BToaster:{ariaLive:null,ariaAtomic:null,role:null},BTooltip:{boundary:"scrollParent",boundaryPadding:5,customClass:null,delay:0,variant:null}}),Ft=a.prototype,Ht=function(t){return Ft.$bvConfig?Ft.$bvConfig.getConfigValue(t):Vt(Lt(Bt,t))},Nt=function(){return Ht("breakpoints")},Ut=St(function(){return Nt()}),jt=function(){return Vt(Ut())},Qt=St(function(){var t=jt();return t[0]="",t}),Mt=function(){return{type:[Boolean,String,Number],default:!1}},Wt=function(){return{type:[String,Number],default:null}},Gt=function(t,n,o){var e=t;if(!qt(o)&&!Rt(o)&&!1!==o)return n&&(e+="-".concat(n)),"col"!==t||""!==o&&!0!==o?(e+="-".concat(o),e.toLowerCase()):e.toLowerCase()},Xt=St(Gt),Jt=Et(null),Yt=function(){var t=Qt().filter(Boolean),n=t.reduce(function(t,n){return n&&(t[n]=Mt()),t},Et(null)),o=t.reduce(function(t,n){return t[It(n,"offset")]=Wt(),t},Et(null)),e=t.reduce(function(t,n){return t[It(n,"order")]=Wt(),t},Et(null));return Jt=$t(Et(null),{col:kt(n),offset:kt(o),order:kt(e)}),I({col:{type:Boolean,default:!1},cols:Wt()},n,{offset:Wt()},o,{order:Wt()},e,{alignSelf:{type:String,default:null,validator:function(t){return Ct(["auto","start","end","center","baseline","stretch"],t)}},tag:{type:String,default:"div"}})},Zt={name:"BCol",functional:!0,get props(){return delete this.props,this.props=Yt()},render:function(t,n){var o,e=n.props,i=n.data,a=n.children,s=[];for(var r in Jt)for(var c=Jt[r],l=0;l<c.length;l++){var d=Xt(r,c[l].replace(r,""),e[c[l]]);d&&s.push(d)}var u=s.some(function(t){return/^col-/.test(t)});return s.push((o={col:e.col||!u&&!e.cols},V(o,"col-".concat(e.cols),e.cols),V(o,"offset-".concat(e.offset),e.offset),V(o,"order-".concat(e.order),e.order),V(o,"align-self-".concat(e.alignSelf),e.alignSelf),o)),t(e.tag,k(i,{class:s}),a)}},Kt={name:"AnnotationTile",props:{annotation:{type:Object,default:function(){return null}},edit:{type:Boolean,default:function(){return!1}}},data:function(){return{title:"",timer:null,clickCounter:0,doubleClickTimeout:200}},created:function(){this.title=this.annotation.note.title},watch:{title:function(){this.updateAnnotationTitle(this)}},methods:{clickEvent:function(t){var n=this;t.preventDefault(),this.clickCounter=this.clickCounter+1,1===this.clickCounter?this.timer=setTimeout(function(){n.clickCounter=0,n.selectAnnotation()},this.doubleClickTimeout):2===this.clickCounter&&(clearTimeout(this.timer),this.clickCounter=0,this.hideAnnotation())},selectAnnotation:function(){this.$emit("select-annotation",this.annotation)},hideAnnotation:function(){this.$emit("hide-annotation",this.annotation)},deleteAnnotation:function(){this.$emit("delete-annotation",this.annotation)},updateAnnotation:function(){var t={id:this.annotation.id,annotationType:this.annotation.annotationType,note:{title:this.title},data:this.annotation.data,color:this.annotation.color,subject:this.annotation.subject};this.$emit("update-annotation",t)},updateAnnotationTitle:u.debounce(function(t){return t.updateAnnotation()},200)}};const tn=Kt;var nn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"annotation-tile"},[o("b-card",{staticClass:"bg-transparent border-0 m-1 ml-1",style:{borderColor:t.annotation.color},attrs:{"no-body":""}},[o("b-input-group",[o("b-input-group-prepend",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],style:{borderColor:t.annotation.color},attrs:{title:JSON.stringify(t.annotation.data)},on:{click:t.clickEvent}},[o("span",{staticClass:"input-group-text",style:{backgroundColor:t.annotation.color,borderColor:t.annotation.color}},[t.annotation.annotationType===t.$annomlutils.annotation.types.POINT?o("font-awesome-layers",[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1):t.annotation.annotationType===t.$annomlutils.annotation.types.FREEPOINT?o("font-awesome-layers",[o("font-awesome-icon",{attrs:{icon:"bullseye"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-9 down-7 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-5 right-6"}})],1):t.annotation.annotationType===t.$annomlutils.annotation.types.RECTANGLE?o("font-awesome-layers",[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-6 down-6 right-6"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"database",transform:"shrink-5 down-6 right-6"}})],1):t.annotation.annotationType===t.$annomlutils.annotation.types.FREERECTANGLE?o("font-awesome-layers",[o("font-awesome-icon",{attrs:{icon:"vector-square"}}),t._v(" "),o("font-awesome-icon",{style:{color:"gray"},attrs:{icon:"circle",transform:"shrink-9 down-6 right-7"}}),t._v(" "),o("font-awesome-icon",{attrs:{icon:"hand-pointer",transform:"shrink-4 down-4 right-6"}})],1):t._e()],1)]),t._v(" "),o("b-form-input",{style:{borderColor:t.annotation.color},attrs:{readonly:!t.edit,disabled:!t.edit,id:"annotation-title"},model:{value:t.title,callback:function(n){t.title="string"==typeof n?n.trim():n},expression:"title"}}),t._v(" "),t.edit?o("b-input-group-append",{style:{borderColor:t.annotation.color,width:"40px"}},[o("b-button",{style:{backgroundColor:t.annotation.color,borderColor:t.annotation.color},attrs:{variant:"outline-secondary"},on:{click:t.deleteAnnotation}},[o("font-awesome-icon",{staticStyle:{"{color":"white}"},attrs:{icon:"times"}})],1)],1):t._e()],1)],1)],1)},on=[];const en=function(t){t&&t("data-v-2888761c_0",{source:'.UniqueFullWidth .input-group-text[data-v-2888761c]{width:50px;flex:0 0 20%;border-right:none;background-color:#fff}.UniqueFullWidth [class^=fa-][data-v-2888761c],[class*=" fa-"][data-v-2888761c]{display:inline-block;color:#fff;width:100%}.form-control[data-v-2888761c]:disabled,.form-control[readonly][data-v-2888761c]{background-color:#fff;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}',map:void 0,media:void 0})};var an=W({render:nn,staticRenderFns:on},en,tn,"data-v-2888761c",!1,void 0,Y,void 0),sn={name:"AnnotationList",components:{BCol:Zt,Swatches:f,AnnotationTile:an},props:{pointAnnotations:{type:Array,default:function(){return[]}},rectangleAnnotations:{type:Array,default:function(){return[]}},annotationColor:{type:String,default:function(){return null}},edit:{type:Boolean,default:function(){return!1}}},data:function(){return{annotations:[],color:this.annotationColor,annotationsHidden:!1}},created:function(){this.annotationColor?this.color=this.annotationColor:this.color=j.annotation.getFreeColor(this.$annomlstore.getters.getUsedColors),this.annotations=j.annotation.concatAndSortAnnotations([this.rectangleAnnotations,this.pointAnnotations],function(t,n){return t.id-n.id}),this.annotationsHidden=this.annotations.some(function(t){return t.color!==j.annotation.stateColor.HIDDEN})},watch:{color:function(){this.updateColor(this.color)},pointAnnotations:{handler:function(){this.annotations=j.annotation.concatAndSortAnnotations([this.rectangleAnnotations,this.pointAnnotations],function(t,n){return t.id-n.id}),this.annotationsHidden=this.annotations.some(function(t){return t.color!==j.annotation.stateColor.HIDDEN})},deep:!0},rectangleAnnotations:{handler:function(){this.annotations=j.annotation.concatAndSortAnnotations([this.rectangleAnnotations,this.pointAnnotations],function(t,n){return t.id-n.id}),this.annotationsHidden=this.annotations.some(function(t){return t.color!==j.annotation.stateColor.HIDDEN})},deep:!0}},methods:{selectAnnotation:function(t){this.$emit("select-annotation",t)},hideAnnotation:function(t){this.$emit("hide-annotation",t)},hideAllAnnotations:function(){this.$emit("hide-all-annotations",this.annotationsHidden),this.annotationsHidden=!this.annotationsHidden},deleteAnnotation:function(t){this.$emit("delete-annotation",t)},updateAnnotation:function(t){this.$emit("update-annotation",t)},updateColor:function(t){this.$emit("update-color",t)}}};const rn=sn;var cn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("b-container",{attrs:{fluid:""}},[o("b-row",[o("b-col",{staticClass:"pl-0",attrs:{cols:"1"}},[t.edit?o("swatches",{staticClass:"vue-swatches",attrs:{colors:t.$annomlutils.annotation.postColors,"show-fallback":t.$annomlstore.getters.getUsedColors.length>t.$annomlutils.annotation.postColors.length,"row-length":"5",exceptions:t.$annomlstore.getters.getUsedColors.filter(function(n){return n!==t.annotationColor}),shapes:"circles","exception-mode":"hidden","popover-to":"right"},model:{value:t.color,callback:function(n){t.color=n},expression:"color"}}):o("div",{staticClass:"annotation-color-swatch",class:{annotationsHidden:t.annotationsHidden},style:{backgroundColor:t.annotationsHidden?t.annotationColor:t.$annomlutils.annotation.stateColor.HIDDEN},on:{click:t.hideAllAnnotations}})],1),t._v(" "),o("b-col",[o("b-card-group",t._l(t.annotations,function(n){return o("annotation-tile",{key:n.id,attrs:{annotation:n,edit:t.edit},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"delete-annotation":t.deleteAnnotation,"update-annotation":t.updateAnnotation}})}),1)],1)],1)],1)},ln=[];const dn=function(t){t&&t("data-v-28f92f56_0",{source:".annotation-color-swatch{width:42px;height:42px;background-color:#d3d3d3;border-radius:50%}.annotation-color-swatch:hover{transform:scale(.95)}fieldset[disabled] .vue-swatches{pointer-events:none}.vue-swatches{position:relative;outline:0}.vue-swatches__trigger{display:inline-block;cursor:pointer}.vue-swatches__trigger.vue-swatches--is-empty{border:2px solid #ccc}.vue-swatches__trigger.vue-swatches--is-disabled{cursor:not-allowed}.vue-swatches__container{box-sizing:content-box;padding:5px}.vue-swatches__container:not(.vue-swatches--inline){position:absolute;display:block;overflow:auto;border-radius:5px;box-shadow:0 2px 3px hsla(0,0%,4%,.2),0 0 0 1px hsla(0,0%,4%,.2);z-index:50}.vue-swatches__wrapper{background-color:inherit}.vue-swatches__row{font-size:0}.vue-swatches__fallback__wrapper{display:table}.vue-swatches__fallback__input--wrapper{display:table-cell;padding-right:10px;width:100%;font-size:14px}.vue-swatches__fallback__input{width:100%;padding-top:6px;padding-bottom:6px;border-radius:5px;border:1px solid #dcdcdc;color:#35495e;background:#fff}.vue-swatches__fallback__button{display:table-cell;padding:6px 15px;border:0;cursor:pointer;font-weight:700;color:#fff;background-color:#3571c8;border-radius:5px}.vue-swatches-show-hide-enter-active,.vue-swatches-show-hide-leave-active{transition:all .3s ease}.vue-swatches-show-hide-enter,.vue-swatches-show-hide-leave-active{opacity:0}.vue-swatches--has-children-centered{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}.vue-swatches__diagonal--wrapper{width:100%;height:100%}.vue-swatches__diagonal{width:75%;height:75%;background:linear-gradient(to top right,transparent 0,transparent calc(50% - 2.4px),#de080a 50%,transparent calc(50% + 2.4px),transparent)}.vue-swatches__swatch{position:relative;font-size:0}.vue-swatches__swatch:focus,.vue-swatches__swatch:hover{opacity:.9;box-shadow:inset 0 0 2px rgba(0,0,0,.75);outline:0}.vue-swatches__swatch.vue-swatches__swatch--border,.vue-swatches__swatch.vue-swatches__swatch--selected{box-shadow:inset 0 0 2px rgba(0,0,0,.75)}.vue-swatches__swatch .vue-swatches__diagonal--wrapper{position:absolute}.vue-swatches__check__wrapper{position:absolute;width:100%;height:100%}.vue-swatches__check__circle{width:21px;height:21px;border-radius:50%;background-color:rgba(0,0,0,.15)}.vue-swatches__check__path{fill:#fff}",map:void 0,media:void 0})};var un=W({render:cn,staticRenderFns:ln},dn,rn,void 0,!1,void 0,Y,void 0),mn={name:"vote",data:function(){return{votes:0}},props:{edit:{type:Boolean,default:function(){return!1}},post:{type:Object,default:function(){return{}}}},watch:{post:{handler:function(){null!==this.post.upVotes&&this.post.downVotes&&(this.votes=this.post.upVotes.length-this.post.downVotes.length)},deep:!0}},created:function(){this.votes=this.post.upVotes.length-this.post.downVotes.length},methods:{voteCounter:function(){return this.votes>0?"+".concat(this.votes):this.votes<0?this.votes:"0"},voteUp:function(){var t=this;0===this.post.upVotes.filter(function(n){return n.externalId===t.$annomlsettings.currentUser}).length&&this.$emit("up-vote")},voteDown:function(){var t=this;0===this.post.downVotes.filter(function(n){return n.externalId===t.$annomlsettings.currentUser}).length&&this.$emit("down-vote")}}};const hn=mn;var fn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"vote pull-right btn"},[t.edit?o("span",{on:{click:function(n){return t.voteUp()}}},[o("font-awesome-icon",{attrs:{icon:"chevron-up"}})],1):t._e(),t._v(" "),o("div",[t._v(t._s(t.voteCounter()))]),t._v(" "),t.edit?o("span",{on:{click:function(n){return t.voteDown()}}},[o("font-awesome-icon",{attrs:{icon:"chevron-down"}})],1):t._e()])},pn=[];const gn=function(t){t&&t("data-v-51722740_0",{source:".vote{display:block}.vote span{color:gray;text-align:center;margin-left:auto;margin-right:auto;height:30px;width:30px;display:inline-block}.vote div{color:#000;text-align:center;margin-left:auto;margin-right:auto;height:30px;width:30px;display:inline-block}.vote span:hover{color:#000;transform:scale(1.2)}",map:void 0,media:void 0})};var vn=W({render:fn,staticRenderFns:pn},gn,hn,void 0,!1,void 0,Y,void 0),bn={name:"PostMeta",props:{post:{type:Object,default:function(){return null}}},created:function(){},methods:{checkIfIsSameDate:function(t,n){return t!==n},formatTimestamp:function(t){var n=new Date(t);return"".concat(n.toLocaleDateString()," at ").concat(n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},formatEditTimestamp:function(t,n){var o=new Date(t),e=new Date(n);return o.getDate()===e.getDate()?"last edit at ".concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):"edited on ".concat(e.toLocaleDateString(),"at").concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},requestUsername:function(t){Q(this.$authApi).getUser(this.$annomlstore.getters.getSettings.authenticationProvider.endpoints.userInfoById,t).then(function(t){console.log(t)})}}};const _n=bn;var wn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return t.post.author?o("div",{staticClass:"post-info"},[t.post.author.externalId?o("span",{staticClass:"username"},[t._v("\n    "+t._s(t.post.author.externalId))]):o("span",{staticClass:"username"},[t._v("User #"+t._s(t.post.author.id))]),t._v(" "),t.post.created?o("span",{staticClass:"created"},[t._v("\n    on "+t._s(t.formatTimestamp(t.post.created)))]):t._e(),t._v(" "),t.checkIfIsSameDate(t.post.created,t.post.edited)?o("span",{staticClass:"edited"},[t._v("\n    ("+t._s(t.formatEditTimestamp(t.post.created,t.post.edited))+")")]):t._e()]):t._e()},An=[];const yn=function(t){t&&t("data-v-73e19b2f_0",{source:".username[data-v-73e19b2f]{font-size:larger;font-weight:700}.edited[data-v-73e19b2f]{font-weight:lighter}",map:void 0,media:void 0})};var Cn=W({render:wn,staticRenderFns:An},yn,_n,"data-v-73e19b2f",!1,void 0,Y,void 0),$n={name:"Comment",components:{Vote:vn,PostMeta:Cn,EditorContent:m.EditorContent,AnnotationSelect:un},props:{comment:{type:Object,default:function(){return{}}},question:{type:Object,default:function(){return null}}},data:function(){return{editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline],editable:!1,content:this.comment.body}),currentEdit:null}},created:function(){},mounted:function(){},beforeDestroy:function(){this.editor.destroy()},methods:{editComment:function(){this.$emit("edit-comment",this.comment)},upVoteComment:function(){this.$emit("up-vote-comment",this.comment)},downVoteComment:function(){this.$emit("down-vote-comment",this.comment)},selectAnnotation:function(t){j.annotation.selectAnnotation([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},hideAnnotation:function(t){j.annotation.hideAnnotation([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},hideAnnotations:function(t){j.annotation.hideAnnotations([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},deleteAnnotation:function(t){this.$emit("delete-annotation",t)}}};const kn=$n;var xn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("b-card",{staticClass:"mb-2 ml-4"},[!t.comment.author||t.$annomlsettings.currentUser===t.comment.author.externalId&&t.question.highlight!==t.comment.id?t._e():o("highlight",{staticClass:"float-right",attrs:{edit:t.$annomlsettings.currentUser===t.question.author.externalId,highlight:t.question.highlight===t.comment.id}}),t._v(" "),t.$annomlstore.getters.debug?o("span",{staticClass:"float-right mr-1",staticStyle:{color:"lightgray"}},[t._v("\n      #"+t._s(t.comment.id)+"\n    ")]):t._e(),t._v(" "),o("post-meta",{attrs:{post:t.comment}}),t._v(" "),t.comment.pointAnnotations.length>0||t.comment.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.comment.pointAnnotations,"rectangle-annotations":t.comment.rectangleAnnotations,"annotation-color":t.comment.color,edit:!1},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"hide-all-annotations":t.hideAnnotations}}):t._e(),t._v(" "),o("div",{staticClass:"body"},[o("editor-content",{staticClass:"editor__content",attrs:{editor:t.editor}})],1),t._v(" "),t.comment.author?o("div",[o("vote",{staticClass:"float-right btn",attrs:{post:t.comment,edit:t.$annomlsettings.isAuthenticated},on:{"up-vote":t.upVoteComment,"down-vote":t.downVoteComment}}),t._v(" "),t.$annomlsettings.currentUser!==t.comment.author.externalId||t.$annomlstore.getters.getCurrentPost?t._e():o("b-button",{staticClass:"float-right",attrs:{variant:"light"},on:{click:t.editComment}},[t._v("Edit")])],1):t._e()],1)],1)},En=[];const Pn=function(t){t&&t("data-v-64501c2c_0",{source:'.body{margin-top:.5rem;margin-bottom:.5rem;pointer-events:none}.body__content{word-wrap:break-word}.body__content .ProseMirror{position:relative;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box}.body__content__content{word-wrap:break-word}.body__content__content *{caret-color:currentColor}.body__content__content p{margin-top:.2rem;margin-bottom:.2rem}.body__content__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.body__content__content pre code{display:block}.body__content__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.body__content__content ol,.body__content__content ul{padding-left:1rem}.body__content__content li>ol,.body__content__content li>p,.body__content__content li>ul{margin:0}.body__content__content a{color:inherit}.body__content__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.body__content__content blockquote p{margin:0}.body__content__content img{max-width:100%;border-radius:3px}.body__content__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.body__content__content table td,.body__content__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.body__content__content table td>*,.body__content__content table th>*{margin-bottom:0}.body__content__content table th{font-weight:700;text-align:left}.body__content__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.body__content__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.body__content__content .tableWrapper{margin:1em 0;overflow-x:auto}.body__content__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var zn=W({render:xn,staticRenderFns:En},Pn,kn,void 0,!1,void 0,Y,void 0),Sn={name:"CommentEditor",components:{EditorContent:m.EditorContent,EditorMenuBar:m.EditorMenuBar,AnnotationSelect:un},props:{comment:{type:Object,default:function(){return{}}},pointAnnotations:{type:Array,default:function(){return[]}},rectangleAnnotations:{type:Array,default:function(){return[]}}},data:function(){return{editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline,new h.History],content:this.comment.body})}},methods:{submitComment:function(){if(this.editorHasContent()){this.clearAnnotation();var t={id:this.comment.id,body:this.editor.getJSON(),pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations,upVotes:[],downVotes:[]};(this.pointAnnotations.length>0||this.rectangleAnnotations.length>0)&&(t.color=this.comment.color),this.$emit("save-comment",t)}else alert("Enter a content")},updateComment:function(){var t=this;if(this.editorHasContent()){this.pointAnnotations.forEach(function(n){var o=n;return o.color=t.comment.color,console.log(o),o}),this.rectangleAnnotations.forEach(function(n){var o=n;return o.color=t.comment.color,o});var n={id:this.comment.id,color:this.comment.color,pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations};this.$emit("update-comment",n)}else alert("Enter title and content")},deleteComment:function(){this.$emit("delete-comment",this.comment)},selectAnnotation:function(t){j.annotation.selectAnnotation([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},hideAnnotation:function(t){j.annotation.hideAnnotation([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},hideAnnotations:function(t){j.annotation.hideAnnotations([this.comment.pointAnnotations,this.comment.rectangleAnnotations],t,this.comment.color)},addNewAnnotation:function(){this.$annomlstore.commit("enableSelectable")},clearAnnotation:function(){var t=this;this.pointAnnotations.forEach(function(n){n.color=t.comment.color}),this.rectangleAnnotations.forEach(function(n){n.color=t.comment.color})},deleteAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$annomlstore.commit("removeCurrentPointAnnotation",t):t.annotationType===j.annotation.types.RECTANGLE&&this.$annomlstore.commit("removeCurrentRectangleAnnotation",t)},updateAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$set(this.pointAnnotations,this.pointAnnotations.findIndex(function(n){return n.id===t.id}),t):t.annotationType===j.annotation.types.RECTANGLE&&this.$set(this.rectangleAnnotations,this.$annomlstore.deleteCurrent().findIndex(function(n){return n.id===t.id}),t)},updateAnnotationColor:function(t){this.comment.color?(this.$annomlstore.commit("removeUsedColor",t),this.comment.color=t):this.comment.color=t,this.pointAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)}),this.rectangleAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)})},editorHasContent:function(){return"<p></p>"!==this.editor.getHTML()}},beforeDestroy:function(){this.editor.destroy()}};const Tn=Sn;var qn=function(){var t=this,n=t.$createElement,o=t._self._c||n
;return o("div",[o("b-card",{staticClass:"mb-2 ml-4"},[t.pointAnnotations.length>0||t.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.pointAnnotations,"rectangle-annotations":t.rectangleAnnotations,"annotation-color":t.comment.color,edit:!0},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"delete-annotation":t.deleteAnnotation,"update-annotation":t.updateAnnotation,"update-color":t.updateAnnotationColor}}):t._e(),t._v(" "),o("b-button",{staticClass:"float-right",attrs:{disabled:t.$annomlstore.getters.visualizationSelectable,size:"sm",variant:"outline-primary"},on:{click:t.addNewAnnotation}},[t._v("Add Annotation\n    ")]),t._v(" "),o("div",{staticClass:"editor"},[o("div",{staticClass:"editor-toolbar"},[o("b-button-toolbar",[o("editor-menu-bar",{staticClass:"menubar",attrs:{editor:t.editor},scopedSlots:t._u([{key:"default",fn:function(n){var e=n.commands,i=n.isActive;return[o("b-button-group",{attrs:{size:"sm"}},[o("b-button",{staticClass:"menubar__b-button",class:{active:i.bold()},on:{click:e.bold}},[o("font-awesome-icon",{attrs:{icon:"bold"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.italic()},on:{click:e.italic}},[o("font-awesome-icon",{attrs:{icon:"italic"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.strike()},on:{click:e.strike}},[o("font-awesome-icon",{attrs:{icon:"strikethrough"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.underline()},on:{click:e.underline}},[o("font-awesome-icon",{attrs:{icon:"underline"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.bullet_list()},on:{click:e.bullet_list}},[o("font-awesome-icon",{attrs:{icon:"list-ul"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.ordered_list()},on:{click:e.ordered_list}},[o("font-awesome-icon",{attrs:{icon:"list-ol"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.blockquote()},on:{click:e.blockquote}},[o("font-awesome-icon",{attrs:{icon:"quote-left"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.code_block()},on:{click:e.code_block}},[o("font-awesome-icon",{attrs:{icon:"code"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.undo}},[o("font-awesome-icon",{attrs:{icon:"undo"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.redo}},[o("font-awesome-icon",{attrs:{icon:"undo",flip:"horizontal"}})],1)],1)]}}])})],1)],1),t._v(" "),o("editor-content",{staticClass:"editor__content",attrs:{id:"editor",editor:t.editor}})],1),t._v(" "),t.comment.author?o("b-button",{attrs:{variant:"primary"},on:{click:t.updateComment}},[t._v("Save\n    ")]):o("b-button",{attrs:{variant:"success"},on:{click:t.submitComment}},[t._v("Submit")]),t._v(" "),o("b-button",{staticClass:"ml-2",attrs:{variant:"danger"},on:{click:t.deleteComment}},[t._v("Delete\n    ")])],1)],1)},Rn=[];const Dn=function(t){t&&t("data-v-a8425ab2_0",{source:'.annotation-select{margin-top:.5rem;margin-bottom:.5rem}.editor-toolbar{margin-bottom:.5rem}.icon-flipped{transform:scaleX(-1);-moz-transform:scaleX(-1);-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1)}.editor{margin-top:.5rem;margin-bottom:.5rem}.editor .ProseMirror{resize:vertical;position:relative;overflow-y:scroll;height:calc(1.5em + 5rem + 2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem}.editor .ProseMirror-focused{outline:0}.editor__content{word-wrap:break-word}.editor__content *{caret-color:currentColor}.editor__content p{margin-top:.2rem;margin-bottom:.2rem}.editor__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.editor__content pre code{display:block}.editor__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.editor__content ol,.editor__content ul{padding-left:1rem}.editor__content li>ol,.editor__content li>p,.editor__content li>ul{margin:0}.editor__content a{color:inherit}.editor__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.editor__content blockquote p{margin:0}.editor__content img{max-width:100%;border-radius:3px}.editor__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.editor__content table td,.editor__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.editor__content table td>*,.editor__content table th>*{margin-bottom:0}.editor__content table th{font-weight:700;text-align:left}.editor__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.editor__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.editor__content .tableWrapper{margin:1em 0;overflow-x:auto}.editor__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var On=W({render:qn,staticRenderFns:Rn},Dn,Tn,void 0,!1,void 0,Y,void 0),In={name:"Highlight",props:{highlight:{type:Boolean,default:function(){return!1}},edit:{type:Boolean,default:function(){return!1}}},methods:{toggleHighlight:function(){this.starred=!this.starred}}};const Vn=In;var Ln=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"highlight",class:{edit:t.edit},on:{click:t.toggleHighlight}},[t.highlight?o("font-awesome-icon",{style:{color:"#ffbe3c"},attrs:{icon:"star",size:"2x"}}):o("font-awesome-icon",{style:{color:"lightgray"},attrs:{icon:"star",size:"2x"}})],1)},Bn=[];const Fn=function(t){t&&t("data-v-0d294ab6_0",{source:".highlight[data-v-0d294ab6]{color:gray}.highlight:hover .edit[data-v-0d294ab6]{color:#ffbe3c;transform:scale(.9)}",map:void 0,media:void 0})};var Hn=W({render:Ln,staticRenderFns:Bn},Fn,Vn,"data-v-0d294ab6",!1,void 0,Y,void 0),Nn={name:"Answer",components:{Vote:vn,Highlight:Hn,PostMeta:Cn,CommentEditor:On,Comment:zn,EditorContent:m.EditorContent,AnnotationSelect:un},props:{answer:{type:Object,default:function(){return{}}},question:{type:Object,default:function(){return null}}},data:function(){return{editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline],editable:!1,content:this.answer.body}),comments:[]}},created:function(){var t=this;this.comments=this.answer.comments,this.comments.forEach(function(n){n.color&&t.$annomlstore.commit("addUsedColor",n.color),n.pointAnnotations.length>0&&t.$annomlstore.commit("addPointAnnotations",n.pointAnnotations),n.rectangleAnnotations.length>0&&t.$annomlstore.commit("addRectangleAnnotations",n.rectangleAnnotations)})},mounted:function(){},beforeDestroy:function(){this.editor.destroy()},methods:{editAnswer:function(){this.$emit("edit-answer",this.answer)},upVoteAnswer:function(){this.$emit("up-vote-answer",this.answer)},downVoteAnswer:function(){this.$emit("down-vote-answer",this.answer)},selectAnnotation:function(t){j.annotation.selectAnnotation([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},hideAnnotation:function(t){j.annotation.hideAnnotation([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},hideAnnotations:function(t){j.annotation.hideAnnotations([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},deleteAnnotation:function(t){this.$emit("delete-annotation",t)},commentPost:function(){var t={id:Date.now(),pointAnnotations:[],rectangleAnnotations:[],author:null,upVotes:[],downVotes:[]};this.comments.push(t),this.$annomlstore.commit("disableSelectable"),this.$annomlstore.commit("setCurrentPost",t)},saveComment:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("addUsedColor",t.color),this.$set(this.comments,this.comments.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).addComment(this.answer.id,t).then(function(o){console.log(o),n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color&&o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color),n.$forceUpdate()})},updateComment:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("addUsedColor",t.color),this.$set(this.comments,this.comments.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).updateComment(t).then(function(o){n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color&&o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color)})},deleteComment:function(t){this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("removeUsedColor",t.color),this.comments=this.comments.filter(function(n){return n.id!==t.id}),t.author&&Q(this.$serviceApiAuthenticated).deleteComment(t).then(function(t){console.log(t)})},editComment:function(t){this.$annomlstore.getters.hasCurrentPost||(this.$annomlstore.commit("setCurrentPost",t),t.pointAnnotations.length>0&&(this.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),this.$annomlstore.commit("setCurrentPointAnnotations",t.pointAnnotations)),t.rectangleAnnotations.length>0&&(this.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),this.$annomlstore.commit("setCurrentRectangleAnnotations",t.rectangleAnnotations)))},upVoteComment:function(t){var n=this;Q(this.$serviceApiAuthenticated).upVoteComment(t).then(function(o){n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o)})},downVoteComment:function(t){var n=this;Q(this.$serviceApiAuthenticated).downVoteComment(t).then(function(o){n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o)})}}};const Un=Nn;var jn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("b-card",{staticClass:"mb-2 ml-2"},[!t.answer.author||t.$annomlsettings.currentUser===t.answer.author.externalId&&t.question.highlight!==t.answer.id?t._e():o("highlight",{staticClass:"float-right",attrs:{edit:t.$annomlsettings.currentUser===t.question.author.externalId,highlight:t.question.highlight===t.answer.id}}),t._v(" "),t.$annomlstore.getters.debug?o("span",{staticClass:"float-right mr-1",staticStyle:{color:"lightgray"}},[t._v("\n      #"+t._s(t.answer.id))]):t._e(),t._v(" "),o("post-meta",{attrs:{post:t.answer}}),t._v(" "),t.answer.pointAnnotations.length>0||t.answer.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.answer.pointAnnotations,"rectangle-annotations":t.answer.rectangleAnnotations,"annotation-color":t.answer.color,edit:!1},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"hide-all-annotations":t.hideAnnotations}}):t._e(),t._v(" "),o("div",{staticClass:"body"},[o("editor-content",{staticClass:"editor__content",attrs:{editor:t.editor}})],1),t._v(" "),t.answer.author?o("div",[t.$annomlstore.getters.getCurrentPost?t._e():o("b-button",{attrs:{variant:"primary"},on:{click:t.commentPost}},[t._v("\n        Comment\n      ")]),t._v(" "),o("vote",{staticClass:"float-right btn",attrs:{post:t.answer,edit:t.$annomlsettings.isAuthenticated},on:{"up-vote":t.upVoteAnswer,"down-vote":t.downVoteAnswer}}),t._v(" "),t.$annomlsettings.currentUser!==t.answer.author.externalId||t.$annomlstore.getters.getCurrentPost?t._e():o("b-button",{staticClass:"float-right",attrs:{variant:"light"},on:{click:t.editAnswer}},[t._v("Edit")])],1):t._e()],1),t._v(" "),t._l(t.comments,function(n){return o("div",{key:n.id},[n===t.$annomlstore.getters.getCurrentPost?o("comment-editor",{attrs:{comment:n,"point-annotations":t.$annomlstore.getters.currentPointAnnotations,"rectangle-annotations":t.$annomlstore.getters.currentRectangleAnnotations},on:{"select-annotation":t.selectAnnotation,"delete-annotation":t.deleteAnnotation,"save-comment":t.saveComment,"update-comment":t.updateComment,"delete-comment":t.deleteComment}}):o("comment",{key:n.id,attrs:{comment:n,question:t.question},on:{"edit-comment":t.editComment,"up-vote-comment":t.upVoteComment,"down-vote-comment":t.downVoteComment}})],1)})],2)},Qn=[];const Mn=function(t){t&&t("data-v-468868bb_0",{source:'.annotation-select{margin-top:.5rem;margin-bottom:.5rem}.body{margin-top:.5rem;margin-bottom:.5rem;pointer-events:none}.body__content{word-wrap:break-word}.body__content .ProseMirror{position:relative;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box}.body__content__content{word-wrap:break-word}.body__content__content *{caret-color:currentColor}.body__content__content p{margin-top:.2rem;margin-bottom:.2rem}.body__content__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.body__content__content pre code{display:block}.body__content__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.body__content__content ol,.body__content__content ul{padding-left:1rem}.body__content__content li>ol,.body__content__content li>p,.body__content__content li>ul{margin:0}.body__content__content a{color:inherit}.body__content__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.body__content__content blockquote p{margin:0}.body__content__content img{max-width:100%;border-radius:3px}.body__content__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.body__content__content table td,.body__content__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.body__content__content table td>*,.body__content__content table th>*{margin-bottom:0}.body__content__content table th{font-weight:700;text-align:left}.body__content__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.body__content__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.body__content__content .tableWrapper{margin:1em 0;overflow-x:auto}.body__content__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var Wn=W({render:jn,staticRenderFns:Qn},Mn,Un,void 0,!1,void 0,Y,void 0),Gn={name:"AnswerEditor",components:{EditorContent:m.EditorContent,EditorMenuBar:m.EditorMenuBar,Comment:zn,AnnotationSelect:un},props:{answer:{type:Object,default:function(){return{}}},pointAnnotations:{type:Array,default:function(){return[]}},rectangleAnnotations:{type:Array,default:function(){return[]}}},data:function(){return{editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline,new h.History],content:this.answer.body})}},created:function(){},watch:{},methods:{submitAnswer:function(){if(this.editorHasContent()){this.clearAnnotation();var t={id:this.answer.id,body:this.editor.getJSON(),pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations,upVotes:[],downVotes:[],comments:this.answer.comments};(this.pointAnnotations.length>0||this.rectangleAnnotations.length>0)&&(t.color=this.answer.color),this.$emit("save-answer",t)}else alert("Enter a content")},updateAnswer:function(){var t=this;if(this.editorHasContent()){this.pointAnnotations.forEach(function(n){var o=n;return o.color=t.answer.color,console.log(o),o}),this.rectangleAnnotations.forEach(function(n){var o=n;return o.color=t.answer.color,o});var n={id:this.answer.id,color:this.answer.color,pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations,comments:this.answer.comments};this.$emit("update-answer",n)}else alert("Enter title and content")},deleteAnswer:function(){this.$emit("delete-answer",this.answer)},selectAnnotation:function(t){j.annotation.selectAnnotation([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},hideAnnotation:function(t){j.annotation.hideAnnotation([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},hideAnnotations:function(t){j.annotation.hideAnnotations([this.answer.pointAnnotations,this.answer.rectangleAnnotations],t,this.answer.color)},addNewAnnotation:function(){this.$annomlstore.commit("enableSelectable")},clearAnnotation:function(){var t=this;this.pointAnnotations.forEach(function(n){n.color=t.answer.color}),this.rectangleAnnotations.forEach(function(n){n.color=t.answer.color})},deleteAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$annomlstore.commit("removeCurrentPointAnnotation",t):t.annotationType===j.annotation.types.RECTANGLE&&this.$annomlstore.commit("removeCurrentRectangleAnnotation",t)},updateAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$set(this.pointAnnotations,this.pointAnnotations.findIndex(function(n){return n.id===t.id}),t):t.annotationType===j.annotation.types.RECTANGLE&&this.$set(this.rectangleAnnotations,this.rectangleAnnotations.findIndex(function(n){return n.id===t.id}),t)},updateAnnotationColor:function(t){this.answer.color?(this.$annomlstore.commit("removeUsedColor",t),this.answer.color=t):this.answer.color=t,this.pointAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)}),this.rectangleAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)})},editorHasContent:function(){return"<p></p>"!==this.editor.getHTML()},upVoteComment:function(t){var n=this;Q(this.$serviceApiAuthenticated).upVoteComment(t).then(function(o){n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o)})},downVoteComment:function(t){var n=this;Q(this.$serviceApiAuthenticated).downVoteComment(t).then(function(o){n.$set(n.comments,n.comments.findIndex(function(n){return n.id===t.id}),o)})}},beforeDestroy:function(){this.editor.destroy()}};const Xn=Gn;var Jn=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("b-card",{staticClass:"mb-2 ml-2"},[t.pointAnnotations.length>0||t.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.pointAnnotations,"rectangle-annotations":t.rectangleAnnotations,"annotation-color":t.answer.color,edit:!0},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"delete-annotation":t.deleteAnnotation,"update-annotation":t.updateAnnotation,"update-color":t.updateAnnotationColor}}):t._e(),t._v(" "),o("b-button",{staticClass:"float-right",attrs:{disabled:t.$annomlstore.getters.visualizationSelectable,size:"sm",variant:"outline-primary"},on:{click:t.addNewAnnotation}},[t._v("Add Annotation\n    ")]),t._v(" "),o("div",{staticClass:"editor"},[o("div",{staticClass:"editor-toolbar"},[o("b-button-toolbar",[o("editor-menu-bar",{staticClass:"menubar",attrs:{editor:t.editor},scopedSlots:t._u([{key:"default",fn:function(n){var e=n.commands,i=n.isActive;return[o("b-button-group",{attrs:{size:"sm"}},[o("b-button",{staticClass:"menubar__b-button",class:{active:i.bold()},on:{click:e.bold}},[o("font-awesome-icon",{attrs:{icon:"bold"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.italic()},on:{click:e.italic}},[o("font-awesome-icon",{attrs:{icon:"italic"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.strike()},on:{click:e.strike}},[o("font-awesome-icon",{attrs:{icon:"strikethrough"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.underline()},on:{click:e.underline}},[o("font-awesome-icon",{attrs:{icon:"underline"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.bullet_list()},on:{click:e.bullet_list}},[o("font-awesome-icon",{attrs:{icon:"list-ul"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.ordered_list()},on:{click:e.ordered_list}},[o("font-awesome-icon",{attrs:{icon:"list-ol"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.blockquote()},on:{click:e.blockquote}},[o("font-awesome-icon",{attrs:{icon:"quote-left"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.code_block()},on:{click:e.code_block}},[o("font-awesome-icon",{attrs:{icon:"code"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.undo}},[o("font-awesome-icon",{attrs:{icon:"undo"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.redo}},[o("font-awesome-icon",{attrs:{icon:"undo",flip:"horizontal"}})],1)],1)]}}])})],1)],1),t._v(" "),o("editor-content",{staticClass:"editor__content",attrs:{id:"editor",editor:t.editor}})],1),t._v(" "),t.answer.author?o("b-button",{attrs:{variant:"primary"},on:{click:t.updateAnswer}},[t._v("Save\n    ")]):o("b-button",{attrs:{variant:"success"},on:{click:t.submitAnswer}},[t._v("Submit")]),t._v(" "),o("b-button",{staticClass:"ml-2",attrs:{variant:"danger"},on:{click:t.deleteAnswer}},[t._v("Delete\n    ")])],1),t._v(" "),t._l(t.answer.comments,function(n){return o("comment",{key:n.id,attrs:{comment:n,question:t.question},on:{"up-vote-comment":t.upVoteComment,"down-vote-comment":t.downVoteComment}})})],2)},Yn=[];const Zn=function(t){t&&t("data-v-09106637_0",{source:'.annotation-select{margin-top:.5rem;margin-bottom:.5rem}.editor-toolbar{margin-bottom:.5rem}.icon-flipped{transform:scaleX(-1);-moz-transform:scaleX(-1);-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1)}.editor{margin-top:.5rem;margin-bottom:.5rem}.editor .ProseMirror{resize:vertical;position:relative;overflow-y:scroll;height:calc(1.5em + 5rem + 2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem}.editor .ProseMirror-focused{outline:0}.editor__content{word-wrap:break-word}.editor__content *{caret-color:currentColor}.editor__content p{margin-top:.2rem;margin-bottom:.2rem}.editor__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.editor__content pre code{display:block}.editor__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.editor__content ol,.editor__content ul{padding-left:1rem}.editor__content li>ol,.editor__content li>p,.editor__content li>ul{margin:0}.editor__content a{color:inherit}.editor__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.editor__content blockquote p{margin:0}.editor__content img{max-width:100%;border-radius:3px}.editor__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.editor__content table td,.editor__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.editor__content table td>*,.editor__content table th>*{margin-bottom:0}.editor__content table th{font-weight:700;text-align:left}.editor__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.editor__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.editor__content .tableWrapper{margin:1em 0;overflow-x:auto}.editor__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var Kn=W({render:Jn,staticRenderFns:Yn},Zn,Xn,void 0,!1,void 0,Y,void 0),to={name:"Question",components:{Vote:vn,PostMeta:Cn,EditorContent:m.EditorContent,AnnotationSelect:un,AnswerEditor:Kn,Answer:Wn},props:{question:{type:Object,default:function(){return{}}}},data:function(){return{editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline,new h.History],editable:!1,content:this.question.body}),answers:[]}},created:function(){var t=this;this.answers=this.question.answers,this.answers.forEach(function(n){n.color&&t.$annomlstore.commit("addUsedColor",n.color),n.pointAnnotations.length>0&&t.$annomlstore.commit("addPointAnnotations",n.pointAnnotations),n.rectangleAnnotations.length>0&&t.$annomlstore.commit("addRectangleAnnotations",n.rectangleAnnotations)})},beforeDestroy:function(){this.editor.destroy()},methods:{editQuestion:function(){this.$emit("edit-question",this.question)},upVoteQuestion:function(){this.$emit("up-vote-question",this.question)},downVoteQuestion:function(){this.$emit("down-vote-question",this.question)},selectAnnotation:function(t){j.annotation.selectAnnotation([this.question.pointAnnotations,this.question.rectangleAnnotations],t,this.question.color)},hideAnnotation:function(t){j.annotation.hideAnnotation([this.question.pointAnnotations,this.question.rectangleAnnotations],t,this.question.color)},hideAnnotations:function(t){j.annotation.hideAnnotations([this.question.pointAnnotations,this.question.rectangleAnnotations],t,this.question.color)},deleteAnnotation:function(t){this.$emit("delete-annotation",t)},answerPost:function(){var t={id:Date.now(),pointAnnotations:[],rectangleAnnotations:[],comments:[],author:null,upVotes:[],downVotes:[]};this.answers.push(t),this.$annomlstore.commit("disableSelectable"),this.$annomlstore.commit("setCurrentPost",t)},saveAnswer:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("addUsedColor",t.color),this.$set(this.answers,this.answers.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).addAnswer(this.question.id,t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color&&o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color)})},updateAnswer:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("addUsedColor",t.color),this.$set(this.answers,this.answers.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).updateAnswer(t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color&&o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color)})},deleteAnswer:function(t){this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("removeUsedColor",t.color),this.answers=this.answers.filter(function(n){return n.id!==t.id}),t.author&&Q(this.$serviceApiAuthenticated).deleteAnswer(t).then(function(t){console.log(t)})},editAnswer:function(t){this.$annomlstore.getters.hasCurrentPost||(this.$annomlstore.commit("setCurrentPost",t),t.pointAnnotations.length>0&&(this.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),this.$annomlstore.commit("setCurrentPointAnnotations",t.pointAnnotations)),t.rectangleAnnotations.length>0&&(this.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),this.$annomlstore.commit("setCurrentRectangleAnnotations",t.rectangleAnnotations)))},upVoteAnswer:function(t){var n=this;Q(this.$serviceApiAuthenticated).upVoteAnswer(t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o)})},downVoteAnswer:function(t){var n=this;Q(this.$serviceApiAuthenticated).downVoteAnswer(t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o)})}}};const no=to;var oo=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("b-card",{staticClass:"question mb-2 mt-4"},[o("h2",{staticClass:"question-title"},[t._v("\n      "+t._s(t.question.title)+"\n      "),t.$annomlstore.getters.debug?o("span",{staticClass:"float-right",staticStyle:{color:"lightgray"}},[t._v("\n        #"+t._s(t.question.id))]):t._e()]),t._v(" "),o("post-meta",{attrs:{post:t.question}}),t._v(" "),t.question.pointAnnotations.length>0||t.question.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.question.pointAnnotations,"rectangle-annotations":t.question.rectangleAnnotations,"annotation-color":t.question.color,edit:!1},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"hide-all-annotations":t.hideAnnotations}}):t._e(),t._v(" "),o("div",{staticClass:"body"},[o("editor-content",{staticClass:"editor__content",attrs:{editor:t.editor}})],1),t._v(" "),t.question.author?o("div",[o("b-button",{attrs:{variant:"primary"},on:{click:t.answerPost}},[t._v("\n        Answer\n      ")]),t._v(" "),o("vote",{staticClass:"float-right btn",attrs:{post:t.question,edit:t.$annomlsettings.isAuthenticated},on:{"up-vote":t.upVoteQuestion,"down-vote":t.downVoteQuestion}
}),t._v(" "),t.$annomlsettings.currentUser!==t.question.author.externalId||t.$annomlstore.getters.getCurrentPost?t._e():o("b-button",{staticClass:"float-right",attrs:{variant:"light"},on:{click:t.editQuestion}},[t._v("Edit")]),t._v(" "),o("small",{staticClass:"text-muted"},[t._v(" "+t._s(t.question.date))])],1):t._e()],1),t._v(" "),t._l(t.answers,function(n){return o("div",{key:n.id},[n===t.$annomlstore.getters.getCurrentPost?o("answer-editor",{key:n.id,attrs:{answer:n,"point-annotations":t.$annomlstore.getters.currentPointAnnotations,"rectangle-annotations":t.$annomlstore.getters.currentRectangleAnnotations},on:{"select-annotation":t.selectAnnotation,"delete-annotation":t.deleteAnnotation,"save-answer":t.saveAnswer,"update-answer":t.updateAnswer,"delete-answer":t.deleteAnswer}}):o("answer",{key:n.id,attrs:{answer:n,question:t.question},on:{"edit-answer":t.editAnswer,"up-vote-answer":t.upVoteAnswer,"down-vote-answer":t.downVoteAnswer}})],1)})],2)},eo=[];const io=function(t){t&&t("data-v-1909dbe1_0",{source:'#question-title{font-size:2rem;width:100%}.annotation-select{margin-top:.5rem;margin-bottom:.5rem}.body{margin-top:.5rem;margin-bottom:.5rem;pointer-events:none}.body__content{word-wrap:break-word}.body__content .ProseMirror{position:relative;padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box}.body__content__content{word-wrap:break-word}.body__content__content *{caret-color:currentColor}.body__content__content p{margin-top:.2rem;margin-bottom:.2rem}.body__content__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.body__content__content pre code{display:block}.body__content__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.body__content__content ol,.body__content__content ul{padding-left:1rem}.body__content__content li>ol,.body__content__content li>p,.body__content__content li>ul{margin:0}.body__content__content a{color:inherit}.body__content__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.body__content__content blockquote p{margin:0}.body__content__content img{max-width:100%;border-radius:3px}.body__content__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.body__content__content table td,.body__content__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.body__content__content table td>*,.body__content__content table th>*{margin-bottom:0}.body__content__content table th{font-weight:700;text-align:left}.body__content__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.body__content__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.body__content__content .tableWrapper{margin:1em 0;overflow-x:auto}.body__content__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var ao=W({render:oo,staticRenderFns:eo},io,no,void 0,!1,void 0,Y,void 0),so={name:"QuestionEditor",components:{EditorContent:m.EditorContent,EditorMenuBar:m.EditorMenuBar,AnnotationSelect:un,Answer:Wn},props:{question:{type:Object,default:function(){return{}}},pointAnnotations:{type:Array,default:function(){return[]}},rectangleAnnotations:{type:Array,default:function(){return[]}},discussion:{type:Object,default:function(){return null}}},data:function(){return{title:null,editor:new m.Editor({extensions:[new h.Blockquote,new h.BulletList,new h.CodeBlock,new h.HardBreak,new h.HorizontalRule,new h.ListItem,new h.OrderedList,new h.TodoItem,new h.TodoList,new h.Bold,new h.Code,new h.Italic,new h.Link,new h.Strike,new h.Underline,new h.History],content:this.question.body})}},created:function(){this.title=this.question.title},methods:{submitQuestion:function(){var t=this;if(void 0!==this.title&&""!==this.title&&this.editorHasContent()){this.pointAnnotations.forEach(function(n){var o=n;return o.color=t.question.color,o}),this.rectangleAnnotations.forEach(function(n){var o=n;return o.color=t.question.color,o});var n={id:this.question.id,title:this.title,body:this.editor.getJSON(),color:this.question.color,pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations,upVotes:[],downVotes:[],answers:this.question.answers};this.$emit("save-question",n)}else alert("Enter title and content")},updateQuestion:function(){if(void 0!==this.title&&""!==this.title&&this.editorHasContent()){this.clearAnnotation();var t={id:this.question.id,title:this.title,color:this.question.color,pointAnnotations:this.pointAnnotations,rectangleAnnotations:this.rectangleAnnotations,answers:this.question.answers};this.$emit("update-question",t)}else alert("Enter title and content")},deleteQuestion:function(){this.$emit("delete-question",this.question)},addNewAnnotation:function(){this.$annomlstore.commit("enableSelectable")},selectAnnotation:function(t){var n=this;t.color===j.annotation.stateColor.SELECTED?this.clearAnnotation():(this.pointAnnotations.forEach(function(o){var e=o;e.id===t.id?e.color=j.annotation.stateColor.SELECTED:e.color=n.question.color}),this.rectangleAnnotations.forEach(function(o){var e=o;e.id===t.id?e.color=j.annotation.stateColor.SELECTED:e.color=n.question.color}))},hideAnnotation:function(t){var n=this;t.color===j.annotation.stateColor.HIDDEN?this.clearAnnotation():(this.pointAnnotations.forEach(function(o){var e=o;e.id===t.id?e.color=j.annotation.stateColor.HIDDEN:e.color=n.question.color}),this.rectangleAnnotations.forEach(function(o){var e=o;e.id===t.id?e.color=j.annotation.stateColor.HIDDEN:e.color=n.question.color}))},clearAnnotation:function(){var t=this;this.pointAnnotations.forEach(function(n){n.color=t.question.color}),this.rectangleAnnotations.forEach(function(n){n.color=t.question.color})},deleteAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$annomlstore.commit("removeCurrentPointAnnotation",t):t.annotationType===j.annotation.types.RECTANGLE&&this.$annomlstore.commit("removeCurrentRectangleAnnotation",t)},updateAnnotation:function(t){t.annotationType===j.annotation.types.POINT?this.$set(this.pointAnnotations,this.pointAnnotations.findIndex(function(n){return n.id===t.id}),t):t.annotationType===j.annotation.types.RECTANGLE&&this.$set(this.rectangleAnnotations,this.rectangleAnnotations.findIndex(function(n){return n.id===t.id}),t)},updateAnnotationColor:function(t){this.question.color?(this.$annomlstore.commit("removeUsedColor",t),this.question.color=t):this.question.color=t,this.pointAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)}),this.rectangleAnnotations.forEach(function(n){var o=n;o.color===j.annotation.stateColor.HIDDEN&&o.color===j.annotation.stateColor.SELECTED||(o.color=t)})},editorHasContent:function(){return"<p></p>"!==this.editor.getHTML()},upVoteAnswer:function(t){var n=this;Q(this.$serviceApiAuthenticated).upVoteAnswer(t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o)})},downVoteAnswer:function(t){var n=this;Q(this.$serviceApiAuthenticated).downVoteAnswer(t).then(function(o){n.$set(n.answers,n.answers.findIndex(function(n){return n.id===t.id}),o)})}},beforeDestroy:function(){this.editor.destroy()}};const ro=so;var co=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("b-card",{staticClass:"mt-4 mb-2"},[o("div",{staticClass:"title"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.title,expression:"title",modifiers:{trim:!0}}],attrs:{id:"question-title",placeholder:"Question Title",required:""},domProps:{value:t.title},on:{input:function(n){n.target.composing||(t.title=n.target.value.trim())},blur:function(n){return t.$forceUpdate()}}})]),t._v(" "),t.pointAnnotations.length>0||t.rectangleAnnotations.length>0?o("annotation-select",{staticClass:"annotation-select",attrs:{"point-annotations":t.pointAnnotations,"rectangle-annotations":t.rectangleAnnotations,"annotation-color":t.question.color,edit:!0},on:{"select-annotation":t.selectAnnotation,"hide-annotation":t.hideAnnotation,"delete-annotation":t.deleteAnnotation,"update-annotation":t.updateAnnotation,"update-color":t.updateAnnotationColor}}):t._e(),t._v(" "),o("b-button",{staticClass:"float-right",attrs:{disabled:t.$annomlstore.getters.visualizationSelectable,size:"sm",variant:"outline-primary"},on:{click:t.addNewAnnotation}},[t._v("Add Annotation\n  ")]),t._v(" "),o("div",{staticClass:"editor"},[o("div",{staticClass:"editor-toolbar"},[o("b-button-toolbar",[o("editor-menu-bar",{staticClass:"menubar",attrs:{editor:t.editor},scopedSlots:t._u([{key:"default",fn:function(n){var e=n.commands,i=n.isActive;return[o("b-button-group",{attrs:{size:"sm"}},[o("b-button",{staticClass:"menubar__b-button",class:{active:i.bold()},on:{click:e.bold}},[o("font-awesome-icon",{attrs:{icon:"bold"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.italic()},on:{click:e.italic}},[o("font-awesome-icon",{attrs:{icon:"italic"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.strike()},on:{click:e.strike}},[o("font-awesome-icon",{attrs:{icon:"strikethrough"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__b-button",class:{active:i.underline()},on:{click:e.underline}},[o("font-awesome-icon",{attrs:{icon:"underline"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.bullet_list()},on:{click:e.bullet_list}},[o("font-awesome-icon",{attrs:{icon:"list-ul"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.ordered_list()},on:{click:e.ordered_list}},[o("font-awesome-icon",{attrs:{icon:"list-ol"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.blockquote()},on:{click:e.blockquote}},[o("font-awesome-icon",{attrs:{icon:"quote-left"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",class:{active:i.code_block()},on:{click:e.code_block}},[o("font-awesome-icon",{attrs:{icon:"code"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.undo}},[o("font-awesome-icon",{attrs:{icon:"undo"}})],1),t._v(" "),o("b-button",{staticClass:"menubar__button",on:{click:e.redo}},[o("font-awesome-icon",{attrs:{icon:"undo",flip:"horizontal"}})],1)],1)]}}])})],1)],1),t._v(" "),o("editor-content",{staticClass:"editor__content",attrs:{id:"editor",editor:t.editor}})],1),t._v(" "),o("div",[t.question.author?o("b-button",{attrs:{variant:"primary"},on:{click:t.updateQuestion}},[t._v("Save\n    ")]):o("b-button",{attrs:{variant:"success",disabled:!t.discussion.published},on:{click:t.submitQuestion}},[t._v("Submit")]),t._v(" "),o("b-button",{staticClass:"ml-1",attrs:{variant:"danger"},on:{click:t.deleteQuestion}},[t._v("Delete\n    ")])],1),t._v(" "),t._l(t.question.answers,function(n){return o("answer",{key:n.id,attrs:{post:n,question:t.question}})})],2)},lo=[];const uo=function(t){t&&t("data-v-2a009bfd_0",{source:'#question-title{border:none;font-size:2rem;width:100%}#question-title:focus{outline:0}.annotation-select{margin-top:.5rem;margin-bottom:.5rem}.editor-toolbar{margin-bottom:.5rem}.icon-flipped{transform:scaleX(-1);-moz-transform:scaleX(-1);-webkit-transform:scaleX(-1);-ms-transform:scaleX(-1)}.editor{margin-top:.5rem;margin-bottom:.5rem}.editor .ProseMirror{resize:vertical;position:relative;overflow-y:scroll;height:calc(1.5em + 5rem + 2px);padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem}.editor .ProseMirror-focused{outline:0}.editor__content{word-wrap:break-word}.editor__content *{caret-color:currentColor}.editor__content p{margin-top:.2rem;margin-bottom:.2rem}.editor__content pre{padding:.7rem 1rem;border-radius:5px;background:#000;color:#fff;font-size:.8rem;overflow-x:auto}.editor__content pre code{display:block}.editor__content p code{display:inline-block;padding:0 .4rem;border-radius:5px;font-size:.8rem;font-weight:700;background:rgba(0,0,0,.1);color:rgba(0,0,0,.8)}.editor__content ol,.editor__content ul{padding-left:1rem}.editor__content li>ol,.editor__content li>p,.editor__content li>ul{margin:0}.editor__content a{color:inherit}.editor__content blockquote{border-left:3px solid rgba(0,0,0,.1);color:rgba(0,0,0,.8);padding-left:.8rem;font-style:italic}.editor__content blockquote p{margin:0}.editor__content img{max-width:100%;border-radius:3px}.editor__content table{border-collapse:collapse;table-layout:fixed;width:100%;margin:0;overflow:hidden}.editor__content table td,.editor__content table th{min-width:1em;border:2px solid #ddd;padding:3px 5px;vertical-align:top;box-sizing:border-box;position:relative}.editor__content table td>*,.editor__content table th>*{margin-bottom:0}.editor__content table th{font-weight:700;text-align:left}.editor__content table .selectedCell:after{z-index:2;position:absolute;content:"";left:0;right:0;top:0;bottom:0;background:rgba(200,200,255,.4);pointer-events:none}.editor__content table .column-resize-handle{position:absolute;right:-2px;top:0;bottom:0;width:4px;z-index:20;background-color:#adf;pointer-events:none}.editor__content .tableWrapper{margin:1em 0;overflow-x:auto}.editor__content .resize-cursor{cursor:ew-resize;cursor:col-resize}',map:void 0,media:void 0})};var mo=W({render:co,staticRenderFns:lo},uo,ro,void 0,!1,void 0,Y,void 0),ho={name:"DiscussionView",components:{Question:ao,QuestionEditor:mo},props:{discussion:{type:Object,default:function(){return null}}},data:function(){return{questions:[],editorOpen:!1,maxHeight:0}},mounted:function(){},created:function(){var t=this;this.questions=this.discussion.questions,this.questions.forEach(function(n){n.color&&t.$annomlstore.commit("addUsedColor",n.color),n.pointAnnotations.length>0&&t.$annomlstore.commit("addPointAnnotations",n.pointAnnotations),n.rectangleAnnotations.length>0&&t.$annomlstore.commit("addRectangleAnnotations",n.rectangleAnnotations)}),this.$annomlstore.watch(function(t,n){return n.currentPointAnnotations},function(n){n.length>0&&!t.$annomlstore.getters.hasCurrentPost&&t.createQuestion()}),this.$annomlstore.watch(function(t,n){return n.currentRectangleAnnotations},function(n){n.length>0&&!t.$annomlstore.getters.hasCurrentPost&&t.createQuestion()})},methods:{createQuestion:function(){var t={id:Date.now(),pointAnnotations:[],rectangleAnnotations:[],answers:[],author:null,upVotes:[],downVotes:[]};this.questions.push(t),this.$annomlstore.commit("setCurrentPost",t)},saveQuestion:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("addUsedColor",t.color),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),this.$set(this.questions,this.questions.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).addQuestion(this.discussion.id,t).then(function(o){n.$set(n.questions,n.questions.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color)})},updateQuestion:function(t){var n=this;this.$annomlstore.commit("mergeCurrentAnnotations"),this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),this.$set(this.questions,this.questions.findIndex(function(n){return n.id===t.id}),t),Q(this.$serviceApiAuthenticated).updateQuestion(t).then(function(o){n.$set(n.questions,n.questions.findIndex(function(n){return n.id===t.id}),o),o.pointAnnotations.length>0&&(n.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),n.$annomlstore.commit("addPointAnnotations",o.pointAnnotations)),o.rectangleAnnotations.length>0&&(n.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),n.$annomlstore.commit("addRectangleAnnotations",o.rectangleAnnotations)),o.color!==t.color&&n.$annomlstore.commit("addUsedColor",t.color)})},deleteQuestion:function(t){var n=this;this.$annomlstore.commit("clearCurrentAnnotations"),this.$annomlstore.commit("removeCurrentPost"),this.$annomlstore.commit("enableSelectable"),t.color&&this.$annomlstore.commit("removeUsedColor",t.color),this.questions=this.questions.filter(function(n){return n.id!==t.id}),t.author&&Q(this.$serviceApiAuthenticated).deleteQuestion(this.discussion.id,t).then(function(o){console.log(o),n.$set(n.questions,n.questions.findIndex(function(n){return n.id===t.id}),o)})},editQuestion:function(t){this.$annomlstore.getters.hasCurrentPost||(this.$annomlstore.commit("setCurrentPost",t),t.pointAnnotations.length>0&&(this.$annomlstore.commit("removePointAnnotations",t.pointAnnotations),this.$annomlstore.commit("setCurrentPointAnnotations",t.pointAnnotations)),t.rectangleAnnotations.length>0&&(this.$annomlstore.commit("removeRectangleAnnotations",t.rectangleAnnotations),this.$annomlstore.commit("setCurrentRectangleAnnotations",t.rectangleAnnotations)))},upVoteQuestion:function(t){var n=this;Q(this.$serviceApiAuthenticated).upVoteQuestion(t).then(function(o){n.$set(n.questions,n.questions.findIndex(function(n){return n.id===t.id}),o)})},downVoteQuestion:function(t){var n=this;Q(this.$serviceApiAuthenticated).downVoteQuestion(t).then(function(o){n.$set(n.questions,n.questions.findIndex(function(n){return n.id===t.id}),o)})}}};const fo=ho;var po=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"discussion"},t._l(t.questions,function(n){return o("div",{key:n.id},[n===t.$annomlstore.getters.getCurrentPost?o("question-editor",{key:n.id,attrs:{question:n,"point-annotations":t.$annomlstore.getters.currentPointAnnotations,"rectangle-annotations":t.$annomlstore.getters.currentRectangleAnnotations,discussion:t.discussion},on:{"save-question":t.saveQuestion,"update-question":t.updateQuestion,"delete-question":t.deleteQuestion}}):o("question",{key:n.id,attrs:{question:n},on:{"edit-question":t.editQuestion,"up-vote-question":t.upVoteQuestion,"down-vote-question":t.downVoteQuestion}})],1)}),0)},go=[];var vo=W({render:po,staticRenderFns:go},void 0,fo,void 0,!1,void 0,void 0,void 0),bo={name:"DiscussionInfo",props:{discussion:{type:Object,default:function(){return null}}},data:function(){return{showPublish:!0,title:"",preventSubmit:!0}},watch:{discussion:function(){this.discussion.title&&(this.title=this.discussion.title,this.preventSubmit=!0),this.showPublish=!this.discussion.published},title:{handler:function(){this.preventSubmit=!(this.title!==this.discussion.title&&""!==this.title)}}},created:function(){this.discussion.title&&(this.title=this.discussion.title,this.preventSubmit=!0),this.showPublish=!this.discussion.published},methods:{checkIfIsSameDate:function(t,n){return t!==n},formatTimestamp:function(t){return"".concat(new Date(t).toLocaleDateString())},formatEditTimestamp:function(t,n){var o=new Date(t),e=new Date(n);return o.getDate()===e.getDate()?"last activity at ".concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):"last activity on ".concat(e.toLocaleDateString(),"at").concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},requestUsername:function(t){Q(this.$authApi).getUser(this.$annomlstore.getters.getSettings.authenticationProvider.endpoints.userInfoById,t).then(function(t){console.log(t)})},updateDiscussion:function(){var t=this;""!==this.discussion.title&&Q(this.$serviceApiAuthenticated).updateDiscussion(this.discussion.id,this.discussion.visualizationHash,this.title).then(function(n){t.$emit("update-discussion",n)}).catch(function(t){return console.log(t)})},deleteDiscussion:function(){var t=this;Q(this.$serviceApiAuthenticated).deleteDiscussion(this.discussion.id).then(function(){t.$router.back()}).catch(function(t){return console.log(t)})}}};const _o=bo;var wo=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("b-card",{staticClass:"discussion-info mt-2 "},[o("b-container",{attrs:{fluid:""}},[o("b-row",[o("b-col",{attrs:{cols:"2"}},[o("div",{staticClass:"discussion-meta align-top"},[t._v("\n          Created by\n          "),t.discussion.author.externalId?o("span",{staticClass:"username"},[t._v("\n            "+t._s(t.discussion.author.externalId))]):o("span",{staticClass:"username"},[t._v("User #"+t._s(t.discussion.author.id))]),t._v(" "),t.discussion.created?o("span",{staticClass:"created"},[t._v("\n            on "+t._s(t.formatTimestamp(t.discussion.created)))]):t._e(),t._v(" "),t.checkIfIsSameDate(t.discussion.created,t.discussion.edited)?o("span",{staticClass:"edited"},[t._v("\n            ("+t._s(t.formatEditTimestamp(t.discussion.created,t.discussion.edited))+")\n          ")]):t._e()])]),t._v(" "),o("b-col",{attrs:{cols:"8"}},[o("div",{staticClass:"discussion-title"},[t.$annomlsettings.currentUser===t.discussion.author.externalId?o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.title,expression:"title",modifiers:{trim:!0}}],attrs:{placeholder:"Enter a discussion title",required:""},domProps:{value:t.title},on:{input:function(n){n.target.composing||(t.title=n.target.value.trim())},blur:function(n){return t.$forceUpdate()}}}):o("span",[t._v(t._s(t.discussion.title))])])]),t._v(" "),o("b-col",{attrs:{cols:"2"}},[t.$annomlsettings.currentUser===t.discussion.author.externalId?o("div",{staticClass:"float-right mt-1"},[t.discussion.published?o("b-button",{attrs:{variant:"primary",disabled:t.preventSubmit},on:{click:t.updateDiscussion}},[t._v("Save")]):o("b-button",{attrs:{disabled:t.preventSubmit,id:"publish",variant:"success"},on:{click:t.updateDiscussion}},[t._v("Publish")]),t._v(" "),o("b-button",{staticClass:"ml-2",attrs:{variant:"danger"},on:{click:t.deleteDiscussion}},[t._v("Delete")]),t._v(" "),t.discussion.published?t._e():o("b-popover",{attrs:{target:"publish",placement:"bottom",show:t.showPublish,title:"Please enter a title and publish!",content:"Otherwise all changes get lost after leaving this page",triggers:"none",delay:{show:100}}})],1):t._e()])],1)],1)],1)},Ao=[];const yo=function(t){t&&t("data-v-2c1427a5_0",{source:".discussion-title[data-v-2c1427a5]{font-size:2rem;width:100%}.discussion-title input[data-v-2c1427a5]{border:none;width:100%}.discussion-title input[data-v-2c1427a5]:focus{outline:0}.discussion-meta .username[data-v-2c1427a5]{font-size:larger;font-weight:700}.discussion-meta .edited[data-v-2c1427a5]{font-weight:lighter;display:block}",map:void 0,media:void 0})};var Co=W({render:wo,staticRenderFns:Ao},yo,_o,"data-v-2c1427a5",!1,void 0,Y,void 0),$o={name:"AnnoML",components:{DiscussionInfo:Co,Loading:ft,DiscussionView:vo,VisualizationView:_t},props:{discussionId:{type:String,default:function(){return null}}},data:function(){return{discussion:null,message:"Loading Discussion",warning:null}},created:function(){this.$annomlstore.commit("clearStore")},mounted:function(){var t=this;Q(this.$serviceApiAuthenticated).getDiscussion(this.discussionId).then(function(n){t.discussion=n}).catch(function(n){t.warning=n.toString()})},methods:{updateDiscussion:function(t){this.discussion=t}}};const ko=$o;var xo=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"annoml-page h-100"},[t.discussion?o("b-container",{attrs:{fluid:""}},[o("b-row",[o("b-col",{attrs:{cols:"12"}},[o("discussion-info",{attrs:{discussion:t.discussion},on:{"update-discussion":t.updateDiscussion}})],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{cols:"12",md:"6"}},[o("visualization-view",{attrs:{discussion:t.discussion}})],1),t._v(" "),o("b-col",{attrs:{cols:"12",md:"6"}},[o("discussion-view",{attrs:{discussion:t.discussion}})],1)],1)],1):o("loading",{attrs:{message:t.message,warning:t.warning}})],1)},Eo=[];var Po=W({render:xo,staticRenderFns:Eo},void 0,ko,void 0,!1,void 0,void 0,void 0),zo={AnnoML:Po};return{install:function(a,s){if(!s)throw new Error("Please initialise plugin with the required configs.");a.component("AnnoML",Po),o.library.add(e.fas),a.use(n),a.component("font-awesome-icon",i.FontAwesomeIcon),a.component("font-awesome-layers",i.FontAwesomeLayers),a.component("font-awesome-layers-text",i.FontAwesomeLayersText),a.prototype.$annomlsettings=s,a.prototype.$annomlstore=B,a.prototype.$annomlutils=j,a.prototype.$resourceApi=t.create({baseURL:s.resourceProvider.baseURL,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS",Authorization:"Bearer ".concat(s.resourceProvider.accessToken)}});var r=t.create({baseURL:s.baseURL,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS"}}),c=function(){return r.defaults.headers.common.Authorization="Bearer ".concat(s.authenticationProvider.authToken),r};a.prototype.$serviceApi=r,a.prototype.$serviceApiAuthenticated=c(),a.prototype.$startDiscussionWithUrl=function(t){return Q(c()).createDiscussionWithUrl(t).then(function(t){return t.id}).catch(function(t){console.log(t)})},a.prototype.$startDiscussionWithReference=function(t){return Q(c()).createDiscussionWithId(t).then(function(t){return t.id}).catch(function(t){console.log(t)})},a.prototype.$startDiscussionWithImport=function(t){return Q(c()).createDiscussionWithSchema(t).then(function(t){return t.id}).catch(function(t){console.log(t)})},B.commit("importSettings",s),s.debug&&console.log("DEBUG MODE")},version:"1.0.13",components:zo}});